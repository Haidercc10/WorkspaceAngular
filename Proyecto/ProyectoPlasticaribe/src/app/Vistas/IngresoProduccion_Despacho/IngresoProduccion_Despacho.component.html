<div class="d-flex justify-content-center overlay" *ngIf="load">
  <div style="margin: auto;">
    <p-progressSpinner></p-progressSpinner>
  </div>
</div>

<div class="contain">
  <!-- Navegador fin de parte superior -->
  <div class="container-fluid">
    <div class="mb-4 Titulo">
      <h2 [ngClass]="{'tituloRojo' : !modoSeleccionado, 'tituloClaro': modoSeleccionado }">Despacho</h2>
    </div>
    <div class="mb-4">
      <hr class="colorLinea">
    </div>
  </div>
</div>

<p-card>
  <p-tabView>
    <p-tabPanel header="Subir Producción" leftIcon="pi pi-upload">
      <div class="my-2">
        <h4 [ngClass]="{'tituloRojo' : !modoSeleccionado, 'tituloClaro': modoSeleccionado }"><i class="pi pi-wrench"></i> Cargar Datos Producción</h4>
      </div>
  
      <div class="row my-5 g-4 justify-content-center">
        <div class="col-sm-12 col-md-2">
          <span class="p-float-label">
            <input type="text" id="RolloBarsCode" pInputText autocomplete="off" pAutoFocus [autofocus]="true" [(ngModel)]="productionSearched" (keyup.enter)="validateUbicationSelected()"/>
            <label for="Rollo">Rollo Leído</label>
          </span>
        </div>

        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-4 col-xl-3 col-xxl-2">
          <span class="p-float-label">
            <p-dropdown [(ngModel)]="storehouseSelected" id="bodegas" optionValue="id" [autoDisplayFirst]="false" [options]="storehouse" optionLabel="nombre" (onChange)="getUbicationByStorehouse()"></p-dropdown>
            <label for="bodegas">Bodega</label>
          </span>
        </div>

        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-4 col-xl-3 col-xxl-2">
          <span class="p-float-label">
            <p-dropdown [(ngModel)]="ubicationSelected" id="ubication" optionValue="nombreCompleto" [autoDisplayFirst]="false" [options]="ubicationsStorehouse" optionLabel="nombreCompleto" (onChange)="getSubUbicationByStorehouse()"></p-dropdown>
            <label for="ubication">Ubicación</label>
          </span>
        </div>

        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-4 col-xl-3 col-xxl-2">
          <span class="p-float-label">
            <p-dropdown [(ngModel)]="subUbicationSelected" id="subUbication" optionValue="idSubUbicacion" [autoDisplayFirst]="false" [options]="subUbicationsStorehouse" optionLabel="nombreCompleto" (onChange)="getCubesBySubUbication()"></p-dropdown>
            <label for="subUbication">Sub Ubicación</label>
          </span>
        </div>

        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-4 col-xl-3 col-xxl-2">
          <span class="p-float-label">
            <p-dropdown [(ngModel)]="cubeSelected" id="cube" optionValue="idCubo" [autoDisplayFirst]="false" [options]="cubes" optionLabel="idCubo"></p-dropdown>
            <label for="cube">Cubos</label>
          </span>
        </div>

        <div class="col-sm-12 col-md-6 col-xl-2" id="iva">
          <div class="field-checkbox my-2 mx-4">
            <p-triStateCheckbox [(ngModel)]="searchIn" inputId="tricheckbox"></p-triStateCheckbox>
            <label for="tricheckbox">
              <p-chip [label]="searchIn == null ? 'Todos' : searchIn ? 'Extrusión/Empaque' : 'Sellado'"
                      [icon]="searchIn == null ? 'pi pi-sync' : searchIn ? 'pi pi-bolt' : 'pi pi-box'"></p-chip>
            </label>
          </div>
        </div>
      </div>

      <div class="d-grid gap-2 d-md-flex justify-content-md-center my-2">
        <button pButton class="p-button-danger m-2" type="button" label="Exportar PDF" icon="pi pi-file-pdf" [disabled]="sendProductionZeus.length == 0" (click)="fillDataProductionIncome()"></button>
        <button pButton class="p-button-secondary m-2" id="limpiar" type="button" label="Limpiar Campos" icon="pi pi-eraser" (click)="clearFields()"></button>
      </div>

      <p-table
      [value]="sendProductionZeus"
      columnResizeMode="expand"
      styleClass="p-datatable-sm"
      responsiveLayout="scroll"
      [rowHover]="true"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando del {first} al {last} de {totalRecords} rollos"
      [scrollable]="true"
      scrollHeight="50rem">
        <ng-template pTemplate="header">
          <tr>
            <th class="text-center">#</th>
            <th class="text-center">OT</th>
            <th class="text-center">Cliente</th>
            <th class="text-center">Rollo</th>
            <th class="text-center">Peso Bruto</th>
            <th class="text-center">Peso Neto</th>
            <th class="text-center">Presentación</th>
            <th class="text-center">Material</th>
            <th class="text-center">Maquina</th>
            <th class="text-center">Fecha</th>
            <th class="text-center">Hora</th>
            <th class="text-center">Turno</th>
            <th class="text-center">Proceso</th>
            <!-- <th class="text-center" alignFrozen="right" pFrozenColumn [frozen]="true">Imprimir</th> -->
            <th class="text-center" alignFrozen="right" pFrozenColumn [frozen]="true">Quitar</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-data let-rowIndex="rowIndex">
          <tr>
            <td class="text-center">{{rowIndex + 1}}</td>
            <td class="text-center">{{data.pp.ot}}</td>
            <td class="text-center">{{data.clientes.cli_Nombre}}</td>
            <td class="text-center">{{data.dataExtrusion.numero_RolloBagPro}}</td>
            <td class="text-center">{{(['Und', 'Paquete'].includes(data.pp.presentacion) ? data.pp.cantidad : data.pp.peso_Bruto) | number : '1.2-2'}}</td>
            <td class="text-center">{{data.pp.peso_Neto | number : '1.2-2'}}</td>
            <td class="text-center">{{data.pp.presentacion}}</td>
            <td class="text-center">{{data.dataExtrusion.material}}</td>
            <td class="text-center">{{data.pp.maquina}}</td>
            <td class="text-center">{{data.pp.fecha | date : 'YYYY-MM-dd'}}</td>
            <td class="text-center">{{data.pp.hora}}</td>
            <td class="text-center">{{data.turno.turno_Nombre}}</td>
            <td class="text-center">{{data.proceso.proceso_Nombre | uppercase}}</td>
            <!-- <td class="text-center" alignFrozen="right" pFrozenColumn [frozen]="true">
              <p-button icon="pi pi-print" [rounded]="true" severity="success" (onClick)="printTag(data)"></p-button> 
            </td> -->
            <td class="text-center" alignFrozen="right" pFrozenColumn [frozen]="true">
              <p-button icon="pi pi-trash" [rounded]="true" severity="danger" (onClick)="removeProduction(data)"></p-button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-tabPanel>

    <p-tabPanel header="Toma Fisíca de Inventario" leftIcon="pi pi-upload">
      <app-TomaFisicaInventario></app-TomaFisicaInventario>
    </p-tabPanel>

    <p-tabPanel header="Consultar Producción" leftIcon="pi pi-search">
      <app-Reporte-Produccion></app-Reporte-Produccion>
    </p-tabPanel>

    <p-tabPanel header="Consultar Ingresos Realizados" leftIcon="pi pi-search">
      <app-Movimientos-IngresosDespacho></app-Movimientos-IngresosDespacho>
    </p-tabPanel>

    <p-tabPanel header="Inventario Bodegas" leftIcon="pi pi-th-large">
      <app-inventarioBodegaDespacho></app-inventarioBodegaDespacho>
    </p-tabPanel>

  </p-tabView>
</p-card>