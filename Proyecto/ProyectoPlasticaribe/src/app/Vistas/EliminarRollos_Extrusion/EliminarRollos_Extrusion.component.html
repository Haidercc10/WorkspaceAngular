<app-menuLateral></app-menuLateral>

<div class="d-flex justify-content-center overlay" *ngIf="!cargando">
  <div class="spinner-border text-danger" role="status" style="margin: auto;">
    <span class="visually-hidden">Cargando...</span>
  </div>
</div>

<div class="contain">
  <!-- Navegador fin de parte superior -->
  <div class="container-fluid">
    <div class="mb-4 Titulo">
      <h2 class="tituloRojo">Eliminar Rollos</h2>
    </div>
    <div class="mb-4">
      <hr class="colorLinea">
    </div>
  </div>
</div>

<div class="contain">
  <!--Inicio info OT-->
  <div class="container-fluid bajarPagina">
    <div class="container">
      <div class="mb-4">
        <h4 class="tituloRojo">Consultar Rollos</h4>
      </div>
      <!-- Formulario para consultar una orden de trabajo -->
      <form [formGroup]="FormConsultarRollos">
        <!-- Primera Fila -->
        <div class="mb-3">
          <div class="row g-3">
            <!-- OT -->
            <div class="form-floating col-md-2">
              <input formControlName="OT_Id" type="number" class="form-control form-control-sm" (keyup.Enter)="consultarRollos()" id="floatingInput">
              <label for="floatingInput">Nro. OT</label>
            </div>

            <!-- Id Rollo -->
            <div class="form-floating col-md-2">
              <input formControlName="IdRollo" type="number" class="form-control form-control-sm" (keyup.Enter)="consultarRollos()" id="floatingInput">
              <label for="floatingInput">N째 Rollo</label>
            </div>

            <!-- Procesos -->
            <div class="form-floating col-md-2">
              <select formControlName="Proceso" id="floatingSelect" type="text" class="form-select form-select-sm" aria-label=".form-select-sm example" required>
                <option [ngValue]="proceso.proceso_Nombre" *ngFor="let proceso of arrayProcesos">{{proceso.proceso_Nombre}}</option>
              </select>
              <label for="floatingSelect">Proceso</label>
            </div>

            <!-- Procesos -->
            <div class="form-floating col-md-2">
              <select formControlName="Bodega" id="floatingSelect" type="text" class="form-select form-select-sm" aria-label=".form-select-sm example" required>
                <option value="EXT">Bodega Extrusion</option>
                <option value="DESP">Bodega Despacho</option>
              </select>
              <label for="floatingSelect">Bodega</label>
            </div>

             <!-- Fecha -->
             <div class="form-floating col-md-2">
              <input formControlName="fechaDoc" type="date" class="form-control" id="floatingInput">
              <label for="floatingInput">Fecha inicial</label>
            </div>

            <!-- Fecha -->
            <div class="form-floating col-md-2">
              <input formControlName="fechaFinalDoc" type="date" class="form-control" id="floatingInput">
              <label for="floatingInput">Fecha Final</label>
            </div>
          </div>
        </div>
        <!-- Botones -->
        <div class="mb-3">
          <div class="d-grid gap-2 d-md-flex justify-content-md-center">
            <div class="form-floating">
              <button class=" btn btn-danger btn-danger-sm" type="button" (click)="consultarRollos()">Consultar rollos</button>
            </div>

            <div class="form-floating">
              <button class="btn btn-secondary btn-outline-secondary-sm" type="button" (click)="limpiarForm()">Limpiar campos</button>
            </div>
          </div>
        </div>
      </form>

      <div class="mb-3">
        <hr class="Linea">
      </div>
      <!-- Inicio titulo tabla producto -->
      <div class="mb-4 tabla1">
        <h4 class="tituloRojo" style="width: 68%;">Tabla de Rollos</h4>
      </div>

      <!--Inicio tabla Rollos creados en OT -->
      <div class="mb-3" *ngIf="cargando">
        <div class="row g-3" style="font-size: 14px;">
          <p-table
              #dt
              [value]="rollos"
              styleClass="p-datatable-gridlines p-datatable-sm"
              responsiveLayout="scroll"
              [paginator]="true"
              [rows]="10"
              [showCurrentPageReport]="true"
              currentPageReportTemplate="Mostrando del {first} al {last} de {totalRecords} rollos"
              [rowsPerPageOptions]="[10,25,50]"
              [rowHover]="true"
              dataKey="Id"
              [(selection)]="rollosInsertar">
            <ng-template pTemplate="header">
              <tr>
                <th scope="col">OT</th>
                <th scope="col">ID Rollo</th>
                <th scope="col">ID Producto</th>
                <th scope="col">Producto</th>
                <th scope="col">Fecha Ingreso</th>
                <th scope="col">Cantidad</th>
                <th scope="col">Presentacion</th>
                <th scope="col">Proceso</th>
                <th style="width: 3rem">
                  <p-tableHeaderCheckbox (click)="seleccionarTodosRollos(rollos)"></p-tableHeaderCheckbox>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rollo>
              <tr>
                <ng-container *ngIf="rollo.exits; then thenTemplate; else elseTemplate"></ng-container>
                <ng-template #thenTemplate>
                  <td style="background-color: rgb(255, 146, 146);">{{rollo.Ot}}</td>
                  <td style="background-color: rgb(255, 146, 146);">{{rollo.Id}}</td>
                  <td style="background-color: rgb(255, 146, 146);">{{rollo.IdProducto}}</td>
                  <td style="background-color: rgb(255, 146, 146);">{{rollo.Producto}}</td>
                  <td style="background-color: rgb(255, 146, 146);">{{rollo.Fecha}}</td>
                  <td style="background-color: rgb(255, 146, 146);">{{rollo.Cantidad | number}}</td>
                  <td style="background-color: rgb(255, 146, 146);">{{rollo.Presentacion}}</td>
                  <td style="background-color: rgb(255, 146, 146);">{{rollo.Proceso}}</td>
                </ng-template>
                <ng-template #elseTemplate>
                  <td>{{rollo.Ot}}</td>
                  <td>{{rollo.Id}}</td>
                  <td>{{rollo.IdProducto}}</td>
                  <td>{{rollo.Producto}}</td>
                  <td>{{rollo.Fecha}}</td>
                  <td>{{rollo.Cantidad | number}}</td>
                  <td>{{rollo.Presentacion}}</td>
                  <td>{{rollo.Proceso}}</td>
                  <td>
                    <p-tableCheckbox [value]="rollo" (click)="llenarRollosAIngresar(rollo)"></p-tableCheckbox>
                  </td>
                </ng-template>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>

      <div class="mb-4">
        <hr class="Linea">
      </div>
      <!-- Inicio titulo tabla producto -->
      <div class="mb-4">
        <h4 class="tituloRojo">Tabla de Rollos por Ingresar</h4>
      </div>

      <!--Inicio tabla Rollos a Insertar -->
      <div class="mb-3" *ngIf="cargando">
        <div class="row g-3">
          <p-table
            #dt
            styleClass="p-datatable-gridlines p-datatable-sm"
            responsiveLayout="scroll"
            [paginator]="true"
            [rows]="10"
            [rowsPerPageOptions]="[10,25,50]"
            [rowHover]="true"
            [value]="rollosInsertar"
            dataKey="Id"
            [(selection)]="rollos">
            <ng-template pTemplate="header">
              <tr>
                <th scope="col">OT</th>
                <th scope="col">ID Rollo</th>
                <th scope="col">ID Producto</th>
                <th scope="col">Producto</th>
                <th scope="col">Cantidad</th>
                <th scope="col">Presentaci처n</th>
                <th scope="col">Proceso</th>
                <th style="width: 3rem">
                  <p-tableHeaderCheckbox (click)="quitarTodosRollos(rollosInsertar)"></p-tableHeaderCheckbox>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rollosInsertar>
              <tr *ngIf="!rollosInsertar.exits">
                <td>{{rollosInsertar.Ot}}</td>
                <td>{{rollosInsertar.Id}}</td>
                <td>{{rollosInsertar.IdProducto}}</td>
                <td>{{rollosInsertar.Producto}}</td>
                <td>{{rollosInsertar.Cantidad | number}}</td>
                <td>{{rollosInsertar.Presentacion}}</td>
                <td>{{rollosInsertar.Proceso}}</td>
                <td>
                  <p-tableCheckbox [value]="rollosInsertar" (click)="quitarRollosAIngresar(rollosInsertar)"></p-tableCheckbox>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>

      <div class="mb-4" *ngIf="cargando">
        <hr class="Linea">
      </div>
      <!-- Inicio titulo tabla producto -->
      <div class="mb-4" *ngIf="cargando">
        <h4 class="tituloRojo">Consolidado Productos</h4>
      </div>

      <!--Inicio tabla Rollos a Insertar -->
      <div class="mb-3" *ngIf="cargando">
        <div class="row g-3">
          <div class="table-responsive">
            <p-table
            #dt
            [resizableColumns]="true"
            columnResizeMode="expand"
            styleClass="p-datatable-gridlines p-datatable-sm"
            responsiveLayout="scroll"
            [paginator]="true"
            [rows]="20"
            [rowHover]="true"
            [value]="grupoProductos">
            <ng-template pTemplate="header">
              <tr>
                <th scope="col">OT</th>
                <th scope="col">ID Producto</th>
                <th scope="col">Producto</th>
                <th scope="col">Cantidad</th>
                <th scope="col">N째 Rollos</th>
                <th scope="col">Presentaci처n</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-grupoProductos>
              <tr>
                <td>{{grupoProductos.Ot}}</td>
                <td>{{grupoProductos.Id}}</td>
                <td>{{grupoProductos.Nombre}}</td>
                <td>{{grupoProductos.Cantidad}}</td>
                <td>{{grupoProductos.Rollos}}</td>
                <td>{{grupoProductos.Presentacion}}</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="footer">
              <tr>
                <td colspan="3" class="text-right">Totales</td>
                <td>{{totalCantidad | number}}</td>
                <td>{{totalRollos | number}}</td>
                <td>Kg</td>
              </tr>
            </ng-template>
          </p-table>
          </div>
        </div>
      </div>

      <!-- Botones -->
      <div class="bajarPagina" *ngIf="cargando">
        <div class="d-grid gap-2 d-md-flex justify-content-md-center">
          <button type="button" class="btn btn-danger" (click)="showDialog()" icon="pi pi-info-circle" label="Show">Eliminar rollos</button>
           <button class="btn btn-secondary btn-outline-secondary-sm" type="button" (click)="limpiarCampos()">Limpiar Campos</button>
        </div>
      </div>
    </div>
  </div>
</div>
