 <!-- Navegador parte superior -->
 <app-menuLateral></app-menuLateral>

 <div class="d-flex justify-content-center overlay" *ngIf="!load">
   <div class="spinner-border text-danger" role="status" style="margin: auto;">
     <span class="visually-hidden">Cargando...</span>
   </div>
 </div>

 <div class="contain">
   <!--  fin Navegador de parte superior -->

   <div class="container-fluid">
     <div class="mb-4 Titulo">
       <h2 class="tituloRojo">Reporte de Pedidos</h2>
     </div>
     <div class="mb-4">
       <hr class="colorLinea">
     </div>

     <div class="container">
       <div class="mb-4">
         <h4 class="tituloRojo">Búsqueda por filtros</h4>
       </div>
       <!-- Inicio formulario Estado OT -->
       <form [formGroup]="formularioOT">
         <!-- Inicio fila 1 de campos -->
         <div class="mb-4">
           <div class="row g-3">
           <!--OT-->
             <div class="form-floating col-md-2">
               <input formControlName="idDocumento" type="number" class="form-control" id="floatingInput" title="N° de la Orden de Trabajo" required >
               <label for="floatingInput">OT</label>
             </div>
             <!-- Fecha inicial -->
             <div class="form-floating col-md-2">
               <input formControlName="fecha" type="date" min="0" class="form-control" id="floatingInput" title="Fecha de creación de la Orden de trabajo" required >
               <label for="floatingInput">Fecha Inicial</label>
             </div>
             <!-- Fecha final -->
             <div class="form-floating col-md-2">
               <input formControlName="fechaFinal" type="date" min="0" class="form-control" id="floatingInput"required >
               <label for="floatingInput">Fecha Final</label>
             </div>

             <!-- Estados -->
             <div class="form-floating col-md-2">
               <select formControlName="estado" class="form-select form-select-sm" id="floatingSelect" title="Estado de la Orden de Trabajo" required>
                 <option [ngValue]="estado.estado_Id" *ngFor="let estado of estados">{{estado.estado_Nombre}}</option>
               </select>
               <label for="floatingSelect">Estado OT</label>
             </div>

             <!-- Vendedores -->
             <div class="ng-autocomplete form-floating col-md form-control form-control-sm" >
              <ng-autocomplete
                class=""
                [data]="vendedores"
                [searchKeyword]="keyword"
                [itemTemplate]="itemTemplate"
                [notFoundTemplate]="notFoundTemplate"
                id="floatingInput"
                placeholder="Nombre Vendedor"
                formControlName="Vendedor">
              </ng-autocomplete>
              <ng-template #itemTemplate let-item>
                <a [innerHTML]="item.usua_Nombre"></a>
              </ng-template>
              <ng-template #notFoundTemplate let-notFound>
                <div [innerHTML]="notFound"></div>
              </ng-template>
              <!-- <label for="floatingInput" >Nombre Vendedor</label> -->
            </div>

             <!-- Observación -->
            <!-- <div class="form-floating col-6 col-md">
               <textarea formControlName="ObservacionOT"  id="floatingTextArea" type="text" class="form-control form-control-sm" maxlength="200" ></textarea>
               <label for="floatingTextArea">Observación</label>
             </div>-->
           </div>
         </div>
      </form>
         <!-- Fila 2 de campos -->
        <div class="mb-4">
          <div class="row g-3">
          <!--Clientes-->
            <div class="form-floating col-md-3">
              <input type="text" [(ngModel)]="PipeCliente" name="PipeCliente" class="form-control" id="floatingInput" title="N° de la Orden de Trabajo" required >
              <label for="floatingInput">Cliente</label>
            </div>
             <!--Productos-->
             <div class="form-floating col-md-3">
              <input type="text" [(ngModel)]="PipeProducto" name="PipeProducto" class="form-control" id="floatingInput" title="N° de la Orden de Trabajo" required >
              <label for="floatingInput">Producto</label>
            </div>
          </div>
        </div>
         <!-- Botones para consultar OT -->
         <div class="mb-3">
           <div class="d-grid gap-2 d-md-flex justify-content-md-center">
             <button class="btn btn-danger btn-danger-sm" type="button" (click)="consultarOT()">Consultar</button>
             <button class="btn btn-secondary btn-secondary-sm" type="button" (click)="limpiarCampos()">Limpiar campos</button>
             <!--<button class="btn btn-danger btn-danger-sm" type="button" (click)="anadirFalla()" title="Para agregar una falla debe seleccionar una OT.">Agregar Falla</button>-->
             <button class="btn btn-danger btn-danger-sm" type="button" (click)="exportToExcel()">Exportar A Excel</button>
           </div>
         </div>

       <!--Fin Formulario -->

       <div class="mb-4">
         <hr class="colorLinea">
       </div>

       <div class="mb-4">
         <h4 class="tituloRojo">Listado de Ordenes de Trabajo</h4>
         <h4 class="tituloRojo" *ngIf="otSeleccionada != 0">OT Seleccionada: {{otSeleccionada}}</h4>
       </div>

       <div *ngIf="load">
        <div class="mb-4">
          <div class="row g-3">
            <!--Inicio Tabla OT-->
            <div class="table-responsive">
              <table class="table table-bordered table-hover mt-2" id="table">
                <thead class="TitulosTabla">
                  <tr>
                    <th id="" scope="col">OT</th>
                    <th id="" scope="col">Cliente</th>
                    <th id="" scope="col">Producto</th>
                    <th id="" scope="col">Extrus.</th>
                    <th id="" scope="col">Impres.</th>
                    <th id="" scope="col">Rotog.</th>
                    <th id="" scope="col">Dobl.</th>
                    <th id="" scope="col">Lamin.</th>
                    <th id="" scope="col">Corte</th>
                    <th id="" scope="col">Empaq.</th>
                    <th id="" scope="col">Sellado</th>
                    <th id="" scope="col">Wiket.</th>
                    <th id="" scope="col">Cantidad Producir</th>
                    <th id="" scope="col">Estados</th>
                    <th id="" scope="col">Fecha Creación</th>
                  </tr>
                </thead>
                  <tbody class="TextosInfoTabla">
                    <tr *ngFor="let tabla of ArrayDocumento | FiltroXClientes_OTVendedores: PipeCliente | FiltroXProducto_OTVendedores: PipeProducto |  paginate: {itemsPerPage: 30, currentPage: page}  let i=index">
                      <!-- Orden de Trabajo -->
                      <td null id="ot" scope="col">{{tabla.ot}}</td>
                      <td null id="cliente" scope="col">{{tabla.cli}}</td>
                      <td null id="producto" scope="col">{{tabla.prod}}</td>
                      <!-- Extrusion -->
                      <ng-container *ngIf="tabla.ext >= tabla.cant">
                        <td id="ext" scope="col" style="background-color: rgb(185, 255, 185);">{{tabla.ext | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.ext < tabla.cant && tabla.ext > 0">
                        <td id="ext" scope="col" style="background-color: rgb(255, 201, 143);">{{tabla.ext | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.ext == 0 && tabla.ext < tabla.cant">
                        <td id="ext" scope="col" style="background-color: rgb(255, 146, 146);">{{tabla.ext | number}}</td>
                      </ng-container>

                      <!-- Impresion -->
                      <ng-container *ngIf="tabla.imp >= tabla.cant">
                        <td id="imp" scope="col" style="background-color: rgb(185, 255, 185);">{{tabla.imp | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.imp < tabla.cant && tabla.imp > 0">
                        <td id="imp" scope="col" style="background-color: rgb(255, 201, 143);">{{tabla.imp | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.imp == 0 && tabla.imp < tabla.cant">
                        <td id="imp" scope="col" style="background-color: rgb(255, 146, 146);">{{tabla.imp | number}}</td>
                      </ng-container>

                      <!-- Rotograbado -->
                      <ng-container *ngIf="tabla.rot >= tabla.cant">
                        <td id="rot" scope="col" style="background-color: rgb(185, 255, 185);">{{tabla.rot | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.rot < tabla.cant && tabla.rot > 0">
                        <td id="rot" scope="col" style="background-color: rgb(255, 201, 143);">{{tabla.rot | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.rot == 0 && tabla.rot < tabla.cant">
                        <td id="rot" scope="col" style="background-color: rgb(255, 146, 146);">{{tabla.rot | number}}</td>
                      </ng-container>

                      <!-- Doblado -->
                      <ng-container *ngIf="tabla.dbl >= tabla.cant">
                        <td id="dbl" scope="col" style="background-color: rgb(185, 255, 185);">{{tabla.dbl | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.dbl < tabla.cant && tabla.dbl > 0">
                        <td id="dbl" scope="col" style="background-color: rgb(255, 201, 143);">{{tabla.dbl | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.dbl == 0 && tabla.dbl < tabla.cant">
                        <td id="dbl" scope="col" style="background-color: rgb(255, 146, 146);">{{tabla.dbl | number}}</td>
                      </ng-container>

                      <!-- laminado -->
                      <ng-container *ngIf="tabla.lam >= tabla.cant">
                        <td id="lam" scope="col" style="background-color: rgb(185, 255, 185);">{{tabla.lam | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.lam < tabla.cant && tabla.lam > 0">
                        <td id="lam" scope="col" style="background-color: rgb(255, 201, 143);">{{tabla.lam | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.lam == 0 && tabla.lam < tabla.cant">
                        <td id="lam" scope="col" style="background-color: rgb(255, 146, 146);">{{tabla.lam | number}}</td>
                      </ng-container>

                      <!-- Corte -->
                      <ng-container *ngIf="tabla.cor >= tabla.cant">
                        <td id="cor" scope="col" style="background-color: rgb(185, 255, 185);">{{tabla.cor | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.cor < tabla.cant && tabla.cor > 0">
                        <td id="cor" scope="col" style="background-color: rgb(255, 201, 143);">{{tabla.cor | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.cor == 0 && tabla.cor < tabla.cant">
                        <td id="cor" scope="col" style="background-color: rgb(255, 146, 146);">{{tabla.cor | number}}</td>
                      </ng-container>

                      <!-- Empaque -->
                      <ng-container *ngIf="tabla.emp >= (tabla.cant + (tabla.cant * -0.10))">
                        <td id="emp" scope="col" style="background-color: rgb(185, 255, 185);">{{tabla.emp | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.emp < (tabla.cant + (tabla.cant * -0.10)) && tabla.emp > 0">
                        <td id="emp" scope="col" style="background-color: rgb(255, 201, 143);">{{tabla.emp | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.emp == 0 && tabla.emp < tabla.cant">
                        <td id="emp" scope="col" style="background-color: rgb(255, 146, 146);">{{tabla.emp | number}}</td>
                      </ng-container>

                      <!-- Sellado -->
                      <ng-container *ngIf="tabla.sel >= (tabla.cant + (tabla.cant * -0.10))">
                        <td id="sel" scope="col" style="background-color: rgb(185, 255, 185);">{{tabla.sel | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.sel < (tabla.cant + (tabla.cant * -0.10)) && tabla.sel > 0">
                        <td id="sel" scope="col" style="background-color: rgb(255, 201, 143);">{{tabla.sel | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.sel == 0 && tabla.sel < tabla.cant">
                        <td id="sel" scope="col" style="background-color: rgb(255, 146, 146);">{{tabla.sel}}</td>
                      </ng-container>

                      <!-- Wiketiado -->
                      <ng-container *ngIf="tabla.wik >= (tabla.cant + (tabla.cant * -0.10))">
                        <td id="wik" scope="col" style="background-color: rgb(185, 255, 185);">{{tabla.wik | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.wik < (tabla.cant + (tabla.cant * -0.10)) && tabla.wik > 0">
                        <td id="wik" scope="col" style="background-color: rgb(255, 201, 143);">{{tabla.wik | number}}</td>
                      </ng-container>
                      <ng-container *ngIf="tabla.wik == 0 && tabla.wik < tabla.cant">
                        <td id="wik" scope="col" style="background-color: rgb(255, 146, 146);">{{tabla.wik | number}}</td>
                      </ng-container>

                      <!-- Cantidad Total a Producir -->
                      <td id="cant" scope="col">{{tabla.cant | number}}</td>

                      <!-- Estado OT -->
                      <td id="est" scope="col">{{tabla.est}}</td>

                      <!-- Fecha Creacion OT -->
                      <td id="fecha" scope="col">{{tabla.fecha | date : 'yyyy-MM-dd'}}</td>
                    </tr>
                  </tbody>
              </table>
              <div class="mb-2">
                <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                  <pagination-controls (pageChange)="page = $event"></pagination-controls>
                </div>
              </div>


              <!--Fin Tabla OT's-->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
