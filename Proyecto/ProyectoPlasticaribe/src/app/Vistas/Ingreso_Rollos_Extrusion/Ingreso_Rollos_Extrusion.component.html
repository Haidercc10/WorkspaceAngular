

<div class="d-flex justify-content-center overlay" *ngIf="cargando">
  <div style="margin: auto;">
    <p-progressSpinner></p-progressSpinner>
  </div>
</div>

<div class="contain">
  <!-- Navegador fin de parte superior -->
  <div class="container-fluid">
    <div class="mb-4 Titulo">
      <h2 [ngClass]="{'tituloRojo': !modoSeleccionado, 'tituloClaro': modoSeleccionado}">Ingreso Bodega Rollos</h2>
    </div>
    <div class="mb-4">
      <hr class="colorLinea">
    </div>
  </div>
</div>

<p-card>

  <div class="mb-5">
    <h4 [ngClass]="{'tituloRojo': !modoSeleccionado, 'tituloClaro': modoSeleccionado}"><i class="pi pi-search"></i> Consultar Producción</h4>
  </div>

  <form [formGroup]="FormConsultarRollos">
    <!-- Primera Fila -->
    <div class="mb-3" id="formulario">
      <div class="row g-4">

        <!--Ubicación-->
        <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 col-xl-4 col-xxl-2">
          <span class="p-float-label">
            <p-dropdown formControlName="Ubicacion" id="Ubicacion" [options]="ubicaciones" [autoDisplayFirst]="false"></p-dropdown>
            <label for="Ubicacion">Ubicacion*</label>
          </span>
        </div>

        <!-- Proceso -->
        <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 col-xl-4 col-xxl-2">
          <span class="p-float-label">
            <p-dropdown formControlName="Proceso" id="proceso" [options]="procesos" optionLabel="proceso_Nombre" optionValue="proceso_Id" [autoDisplayFirst]="false"></p-dropdown>
            <label for="proceso">Proceso*</label>
          </span>
        </div>

        <!-- Numero de Rollo -->
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-4 col-xl-2 col-xxl-2">
          <span class="p-input-icon-left p-float-label">
            <i class="pi pi-search"></i>
            <input formControlName="Rollo" id="Rollo" (keyup.enter)="cargarRolloTabla()" autocomplete="off" type="number" pInputText required/>
            <label for="Rollo">N° Rollo</label>
          </span>
        </div>

         <!-- OT -->
         <div class="col-xs-12 col-sm-12 col-md-6 col-lg-4 col-xl-2 col-xxl-1">
          <span class="p-input-icon-left p-float-label">
            <i class="pi pi-search"></i> 
            <input formControlName="OrdenTrabajo" id="ordenTrabajo" (keyup.enter)="getRolloOrdenProduccion()" type="number" pInputText required/>
            <label for="ordenTrabajo">OT</label>
          </span>
        </div>

        <!-- Ultimo Rollo Ingresado-->
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-4 col-xl-2 col-xxl-2">
          <span class="p-float-label">
            <input formControlName="Ultimo_Rollo" id="Ultimo_Rollo" [readonly]="true" type="number" pInputText required/>
            <label for="Ultimo_Rollo">Ult. rollo</label>
          </span>
        </div>

        <!--Referencia-->
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-4 col-xl-2 col-xxl-3">
          <span class="p-float-label">
            <input formControlName="Referencia" [readonly]="true" id="Referencia" type="text" pInputText required/>
            <label for="Referencia">Referencia</label>
          </span>
        </div>

        <!-- Observacion -->
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-8 col-xl-4 col-xxl-12">
          <span class="p-float-label">
            <textarea formControlName="Observacion" [rows]="1" maxlength="200" pInputTextarea></textarea>
            <label for="textarea">Observación</label>
          </span>
        </div>

      </div>
    </div>

    <!--Botones-->
    <div class="mb-3">
      <div class="row g-3">
        <div class="d-grid gap-3 d-md-flex justify-content-md-center">
          <button pButton pRipple class="p-button-secondary" icon="pi pi-eraser" label="Limpiar campos" id="botones1"></button>
          <button pButton pRipple class="p-button-outlined p-button-secondary" icon="pi pi-eraser" label="Limpiar todo" id="botones1"></button>
        </div>
      </div>
    </div>
  </form>

  <div class="mb-4">
    <hr class="Linea">
  </div>

  <!-- titulo tabla rollos -->
  <div class="mb-4">
    <div class="row g-3">
      <div class="col-xs-12 col-sm-12 col-md-4 col-lg-6 col-xl-6 col-xxl-8">
        <h4 [ngClass]="{'tituloRojo': !modoSeleccionado, 'tituloClaro': modoSeleccionado}" style="width: 68%;"><i class="pi pi-list"></i> Tabla de rollos agregados</h4>
      </div>
      <!-- <div class="col-xs-12 col-sm-12 col-md-4 col-lg-3 col-xl-3 col-xxl-2">
        <p-chip label="Rollos Ingresados: {{rollosIngresados}}" id="rollosIngresados" icon="pi pi-check"></p-chip>
      </div>
      <div class="col-xs-12 col-sm-12 col-md-4 col-lg-3 col-xl-3 col-xxl-2">
        <p-chip label="Rollos No Ingresados: {{rollosSinIngresar}}" id="rollosNoIngresados" icon="pi pi-ban"></p-chip>
      </div> -->
    </div>
  </div>

  <!--Tabla de registros-->
  <div class="mb-4">
    <p-table
      #dt
      *ngIf="!cargando"
      [value]="rollosIngresar"
      styleClass="p-datatable-sm"
      responsiveLayout="scroll"
      [resizableColumns]="true"
      columnResizeMode="expand"
      [rowHover]="true"
      [scrollable]="true"
      scrollHeight="50rem">
        <ng-template pTemplate="header">
          <tr>
            <th></th>
            <th><input pInputText type="number" style="width: 100%;" (input)="aplicarFiltro($event, 'rollo', dt)"></th>
            <th><input pInputText type="number" style="width: 100%;" (input)="aplicarFiltro($event, 'ot', dt)"></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="aplicarFiltro($event, 'cliente', dt)"></th>
            <th><input pInputText type="number" style="width: 100%;" (input)="aplicarFiltro($event, 'item', dt)"></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="aplicarFiltro($event, 'referencia', dt)"></th>
            <th><input pInputText type="number" style="width: 100%;" (input)="aplicarFiltro($event, 'peso', dt)"></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="aplicarFiltro($event, 'unidad', dt)"></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="aplicarFiltro($event, 'proceso', dt)"></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="aplicarFiltro($event, 'ubicacion', dt)"></th>
            <th></th>
          </tr>
          <tr>
            <th class="text-center">#</th>
            <th class="text-center">Rollo</th>
            <th class="text-center">OT</th>
            <th class="text-center">Cliente</th>
            <th class="text-center">Item</th>
            <th class="text-center">Referencia</th>
            <th class="text-center">Peso</th>
            <th class="text-center">Unidad</th>
            <th class="text-center">Proceso</th>
            <th class="text-center">Ubicación</th>
            <th class="text-center" alignFrozen="right" pFrozenColumn [frozen]="true">Quitar</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-data let-rowIndex="rowIndex">
          <tr>
            <td class="text-center">{{(rollosIngresar.length - 1) - rowIndex + 1}}</td>
            <td class="text-center"><b>{{data.rollo}}</b></td>
            <td class="text-center">{{data.ot}}</td>
            <td>{{data.cliente}}</td>
            <td class="text-center">{{data.item}}</td>
            <td><b>{{data.referencia}}</b></td>
            <td class="text-center textBlue"><b>{{data.peso | number : '1.2-2'}}</b></td>
            <td class="text-center"><b>{{data.unidad}}</b></td>
            <td class="text-center">
              <span class="badge" 
              [ngClass]="{'bg-Extrusion': data.proceso == 'EXTRUSION',
              'bg-ProductoIntermedio': data.proceso == 'PRODUCTO INTERMEDIO',
              'bg-Impresion': data.proceso == 'IMPRESION',
              'bg-Rotograbado': data.proceso == 'ROTOGRABADO',
              'bg-Sellado': data.proceso == 'SELLADO',
              'bg-Despacho': data.proceso == 'DESPACHO'}">{{data.proceso}}</span>
            </td>
            <td class="text-center"><b>{{data.ubicacion}}</b></td>
            <td class="text-center" alignFrozen="right" pFrozenColumn [frozen]="true">
              <p-button icon="pi pi-trash" [rounded]="true" (click)="quitarRolloTabla(data)" severity="danger"></p-button>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="12"><h6 class="bold">No hay rollos agregados.</h6></td>
          </tr>
        </ng-template>
        <ng-template pTemplate="footer">
          <tr>
            <td class="text-right" colspan="6">Totales</td>
            <td class="text-center textBlue">{{pesoTotal() | number : '1.2-2'}}</td>
            <td colspan="4"></td>
          </tr>
        </ng-template>
    </p-table>
  </div>
  <!-- Botones -->
  <div *ngIf="!cargando">
    <div class="d-grid gap-2 d-md-flex justify-content-md-center">
      <button pButton class="p-button-danger" id="ingresarRollo" [disabled]="rollosIngresar.length == 0" type="button" label="Ingresar Rollos" icon="pi pi-check" (click)="ingresarRollos()"></button>
      <button pButton class="p-button-secondary" id="limpiarTodo" type="button" label="Limpiar todo" icon="pi pi-eraser" (click)="limpiarCampos()"></button>
    </div>
  </div>
</p-card>
