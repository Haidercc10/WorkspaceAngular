
<div class="d-flex justify-content-center overlay" *ngIf="load">
  <div style="margin: auto;">
    <p-progressSpinner></p-progressSpinner>
  </div>
</div>

<!--Espacio para el titulo-->
<!--<div class="contain">
  <div class="container-fluid">
    <div class="mb-4 Titulo">
      <h2 [ngClass]="{'tituloRojo': !modoSeleccionado, 'tituloClaro': modoSeleccionado}" id="nomina"> Nómina Corte</h2>
    </div>
    <div class="mb-4">
      <hr class="colorLinea">
    </div>
  </div>
</div>-->

<!-- Card con el contenido del módulo -->
<!--<p-card class="font-size-14">

  <div class="mb-4">
    <h2 [ngClass]="{'tituloRojo': !modoSeleccionado, 'tituloClaro': modoSeleccionado}"><i class="pi pi-filter"></i> Filtros de búsqueda</h2>
  </div>-->

    <!--<p-toolbar styleClass="mb-5 gap-3">
      <div class="row" style="width: 100%;">
        
        <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 col-xl-3 col-xxl-3 p-2">
          <span class="p-float-label" id="rango-fechas">
            <p-calendar id="rango" inputId="FechaInicial" [(ngModel)]="rankDates" selectionMode="range" [showIcon]="true" pTooltip="Selecciona el rango de fechas y presiona el botón consultar"></p-calendar>
            <label for="FechaInicial">Rango de Fechas</label>
          </span>
        </div>

        <div class="col">
          <button id="consultar" pButton pRipple pTooltip="Llena el campo rango de fechas y consulta aquí." label="Consultar" icon="pi pi-search" class="p-button-danger botonesOpciones" id="consultar" (click)="searchPayRoll()"></button>
        </div>

        <div class="col justify-content-end text-right">
          <button pButton pRipple label="Exportar a PDF" icon="pi pi-file-pdf" class="p-button-danger mx-2" id="exportar" pTooltip="" (click)="createPDF()"></button>
          <button pButton pRipple label="Exportar a Excel" icon="pi pi-file-excel"class="p-button-success mx-2" id="exportar" pTooltip="" (click)="createExcel()"></button>
        </div>
      </div>
    </p-toolbar>-->

    <!--Tabs para nóminas sectorizadas-->
  <!--<p-tabView id="tabs">-->

    <!-- Nomina Corte -->
    <!--<p-tabPanel
      header="Corte"
      leftIcon="pi pi-tags"
      tooltip="Información de la Nómina de Sellado">
      <div class="mb-3" *ngIf="!load">
        <p-tabView id="tabs">
          <p-tabPanel
            header="Total"
            leftIcon="pi pi-tags"
            tooltip="Nómina de Producción de Corte">-->
            <div class="row g-3 font-size-14" id="table1">
              <p-table
                #dt
                [value]="payRollConsolidate"
                [resizableColumns]="true"
                columnResizeMode="expand"
                styleClass="p-datatable-sm"
                responsiveLayout="scroll"
                [paginator]="true"
                [rows]="payRollConsolidate.length"
                [rowsPerPageOptions]="[10,25,50,100,payRollConsolidate.length]"
                [rowHover]="true"
                dataKey="operator"
                [scrollable]="true"
                scrollHeight="50rem">
                <ng-template pTemplate="header">
                  <!--Filtros-->
                  <tr class="font-size-16" id="filtros">
                    <th></th>
                    <th></th>
                    <th><input pInputText type="number" style="width: 100%;" (input)="applyFilter($event, 'operator', dt)"></th>
                    <th><input pInputText type="text" style="width: 100%;" (input)="applyFilter($event, 'position_Job', dt)"></th>
                    <th><input pInputText type="text" style="width: 100%;" (input)="applyFilter($event, 'weight', dt)"></th>
                    <th><input pInputText type="text" style="width: 100%;" (input)="applyFilter($event, '', dt)"></th>
                    <th><input pInputText type="number" style="width: 100%;" (input)="applyFilter($event, 'value_Pay', dt)"></th>
                  </tr>
                  <!--Encabezado-->
                  <tr id="campos">
                    <th class="text-center" id="desplegable"></th>
                    <th class="text-center" >#</th>
                    <th class="text-center" pSortableColumn="operator" pReorderableColumn scope="col">Nombre Operario<p-sortIcon field="operator"></p-sortIcon></th>
                    <th class="text-center" id="inicial" pSortableColumn="position_Job" pReorderableColumn scope="col">Cargo <p-sortIcon field="position_Job"></p-sortIcon></th>
                    <th class="text-center" scope="col" pSortableColumn="weight">Cant. Producida (Kg) <p-sortIcon field="weight"></p-sortIcon> </th>
                    <th class="text-center" scope="col" pSortableColumn="">Presentación <p-sortIcon field=""></p-sortIcon> </th>
                    <th class="text-center" id="entrada" pSortableColumn="value_Pay" pReorderableColumn scope="col">Valor a pagar<p-sortIcon field="value_Pay"></p-sortIcon></th>
                  </tr>
                </ng-template>
                <!--Cuerpo Tabla 1 -->
                <ng-template pTemplate="body" let-nomina let-expanded="expanded" let-rowIndex="rowIndex">
                  <tr>
                    <td>
                      <button type="button" pButton pRipple [pRowToggler]="nomina" class="p-button-text p-button-rounded p-button-plain" pTooltip="Haz clic para ver más detalles" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
                    </td>
                    <td class="text-center">{{rowIndex + 1}}</td>
                    <td class="text-center"><b>{{nomina.operator}}</b></td>
                    <td class="text-center">{{nomina.position_Job }}</td>
                    <td class="text-center"><b>{{nomina.weight | number : '1.2-2' }}</b></td>
                    <td class="text-center">{{ 'Kg' }}</td>
                    <td class="text-center"> <b style="color: #00a2ff;">$ {{nomina.value_Pay | number : '1.2-2'}}</b></td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="footer">
                  <tr>
                    <td colspan="4" class="text-right">Total Producido</td>
                    <td class="text-center"><b>{{calcTotalProduction() | number : '1.2-2'}}</b></td>
                    <td class="text-right">Total a pagar</td>
                    <td class="text-center" id="total"><b style="color: #00a2ff;">$ {{calcTotalPay() | number : '1.2-2'}}</b></td>
                  </tr>
                </ng-template>
                <!--Tabla 2-->
                <ng-template pTemplate="rowexpansion" let-nomina>
                  <tr>
                    <td colspan="7">
                      <div class="p-3">
                        <p-table
                        [value]="nomina.details"
                        dataKey="operator"
                        styleClass="p-datatable-gridlines p-datatable-sm">
                          <ng-template pTemplate="header">
                            <tr>
                              <th pSortableColumn="operator"> Operario <p-sortIcon field="operator"></p-sortIcon></th>
                              <th pSortableColumn="item"> Item <p-sortIcon field="item"></p-sortIcon></th>
                              <th pSortableColumn="reference"> Referencia <p-sortIcon field="reference"></p-sortIcon></th>
                              <th pSortableColumn="weight">Cant.Producida <p-sortIcon field="weight"></p-sortIcon></th>
                              <th pSortableColumn=""> Und <p-sortIcon field=""></p-sortIcon></th>
                              <th pSortableColumn="turn"> Turno <p-sortIcon field="turn"></p-sortIcon></th>
                              <th pSortableColumn="value_Sunday"> Precio Domingo <p-sortIcon field="value_Sunday"></p-sortIcon></th>
                              <th pSortableColumn="value_Day"> Precio Día <p-sortIcon field="value_Day"></p-sortIcon></th>
                              <th pSortableColumn="value_Night"> Precio Noche <p-sortIcon field="value_Night"></p-sortIcon></th>
                              <th pSortableColumn="value_Pay"> Pago Total <p-sortIcon field="value_Pay"></p-sortIcon></th>
                              <th>Ver</th>
                            </tr>
                          </ng-template>
                          <ng-template pTemplate="body" let-details>
                            <tr>
                              <td>{{ details.operator }}</td>
                              <td><b>{{ details.item }}</b></td>
                              <td>{{ details.reference }}</td>
                              <td><b>{{ details.weight | number : '1.2-2' }}</b></td>
                              <td>{{ 'Kg' }}</td>
                              <td><b>{{ details.turn }}</b></td>
                              <td>$ {{ details.value_Sunday | number : '1.2-2'}}</td>
                              <td>$ {{ details.value_Day | number : '1.2-2'}}</td>
                              <td>$ {{ details.value_Night | number : '1.2-2' }}</td>
                              <td><b>$ {{ details.value_Pay | number : '1.2-2' }}</b></td>
                              <td class="text-center"><button pButton type="button" (click)="loadModal(details.operator, details.item)" style="width: 30px; height: 30px;" class="p-button-success p-button-rounded" pTooltip="Ver detallado de producción del empleado {{details.operator}}" icon="pi pi-eye"></button></td>
                            </tr>
                          </ng-template>
                          <ng-template pTemplate="emptymessage">
                            <tr>
                              <td colspan="6">No se encontraron registros</td>
                            </tr>
                          </ng-template>
                        </p-table>
                      </div>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          <!--</p-tabPanel>-->

         
        <!--</p-tabView>-->
      <!--</div>
    </p-tabPanel>

  </p-tabView>-->

  <!--* tabla detallada por operario(s) -->
  <p-dialog [(visible)]="modal" [style]="{width: '80vw'}" [contentStyle]="{'overflow':'visible'}" [resizable]="true" header="Detalles de la nómina del operario {{operator}}" [modal]="true" styleClass="p-fluid">
    <ng-template pTemplate="content">
      <p-table
        #dtDetailsModal
        [value]="infoModal"
        [resizableColumns]="true"
        columnResizeMode="expand"
        styleClass="p-datatable-gridlines p-datatable-sm"
        responsiveLayout="scroll"
        [rowHover]="true"
        dataKey="roll"
        [scrollable]="true"
        scrollHeight="50rem">
        <ng-template pTemplate="header">
          <tr class="font-size-16" id="filtros">
            <th></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="applyFilter($event, 'date', dtDetailsModal)"></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="applyFilter($event, 'roll', dtDetailsModal)"></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="applyFilter($event, 'material', dtDetailsModal)"></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="applyFilter($event, 'printed', dtDetailsModal)"></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="applyFilter($event, 'laminate', dtDetailsModal)"></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="applyFilter($event, 'weight', dtDetailsModal)"></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="applyFilter($event, 'machine', dtDetailsModal)"></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="applyFilter($event, '', dtDetailsModal)"></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="applyFilter($event, 'turn', dtDetailsModal)"></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="applyFilter($event, 'sunday', dtDetailsModal)"></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="applyFilter($event, 'value_Production', dtDetailsModal)"></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="applyFilter($event, 'value_Pay', dtDetailsModal)"></th>
            <th><input pInputText type="text" style="width: 100%;" (input)="applyFilter($event, 'send_Zeus', dtDetailsModal)"></th>
          </tr>
          <tr>
            <th>#</th>
            <th pSortableColumn="date">Fecha<p-sortIcon field="date"></p-sortIcon></th>
            <th pSortableColumn="roll">Rollo <p-sortIcon field="roll"></p-sortIcon></th>
            <th pSortableColumn="material">Material <p-sortIcon field="material"></p-sortIcon></th>
            <th pSortableColumn="printed">Impreso <p-sortIcon field="printed"></p-sortIcon></th>
            <th pSortableColumn="laminate">Laminado <p-sortIcon field="laminate"></p-sortIcon></th>
            <th pSortableColumn="weight">Peso <p-sortIcon field="weight"></p-sortIcon></th>
            <th pSortableColumn="">Und <p-sortIcon field=""></p-sortIcon></th>
            <th pSortableColumn="machine">Maquina <p-sortIcon field="machine"></p-sortIcon></th>
            <th pSortableColumn="turn">Turno <p-sortIcon field="turn"></p-sortIcon></th>
            <th pSortableColumn="sunday">Domingo/Festivo <p-sortIcon field="sunday"></p-sortIcon></th>
            <th pSortableColumn="value_Production">Precio <p-sortIcon field="value_Production"></p-sortIcon></th>
            <th pSortableColumn="value_Pay">Total <p-sortIcon field="value_Pay"></p-sortIcon></th>
            <th pSortableColumn="send_Zeus">Envio Zeus <p-sortIcon field="send_Zeus"></p-sortIcon></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-data let-rowIndex="rowIndex">
          <tr>
            <td><b>{{rowIndex + 1}}</b></td>
            <td>{{data.date | date : 'dd-MM-yyyy'}} {{data.hour}}</td>
            <td>{{data.roll}}</td>
            <td><b>{{data.material}}</b></td>
            <td>{{data.printed}}</td>
            <td>{{data.laminate}}</td>
            <td><b>{{data.weight | number : '1.2-2'}}</b></td>
            <td>{{'Kg'}}</td>
            <td>{{data.machine}}</td>
            <td><b>{{data.turn}}</b></td>
            <td>{{data.sunday ? 'SI' : 'NO'}}</td>
            <td>$ {{data.value_Production | number : '1.2-2'}}</td>
            <td><b>$ {{data.value_Pay | number : '1.2-2'}}</b></td>
            <td>{{data.send_Zeus ? 'SI' : 'NO'}}</td>
          </tr>
        </ng-template>
      </p-table>

    </ng-template>
  </p-dialog>

  <!--</p-card>-->