<!-- Inicio  -->
<app-menuLateral></app-menuLateral>

<div class="d-flex justify-content-center overlay" *ngIf="!load">
  <div class="spinner-border text-danger" role="status" style="margin: auto;">
    <span class="visually-hidden">Cargando...</span>
  </div>
</div>

<div class="contain">
  <!-- Navegador fin de parte superior -->

  <div class="container-fluid">
    <div class="mb-4 Titulo">
      <h2 class="tituloRojo">Inventario de Productos Terminados</h2>
    </div>
    <div class="mb-4">
      <hr class="colorLinea">
    </div>
    <div class="container">

    <!-- Inicio fila 1 de campos -->
    <div class="mb-4">
      <div class="row g-3">


        <!--<div class="form-floating col-md-4">
          <input type="text" name="NombreCliente" [(ngModel)]="NombreCliente" class="form-control form-control-sm" id="floatingInput" autocomplete="on" required >
          <label for="floatingInput">Cliente</label>
        </div>


        <div class="form-floating col-md-4">
          <input type="text" name="NombrePT" [(ngModel)]="NombrePT" class="form-control form-control-sm" id="floatingInput" autocomplete="on" required >
          <label for="floatingInput">Nombre Producto</label>
        </div>-->

        <!--<form [formGroup]="FormExistencias" id="FormExistencias">
          <div class="mb-3">
            <div class="row g-3">

             <label *ngIf="numeroIdProd != 0">Item: <b>{{numeroIdProd}}</b></label>

              <div class="form-floating col-md-1">
                <input type="number" formControlName="cantidad" class="form-control form-control-sm" id="floatingInput" (keyup.enter)="actualizarCantMinima()">
                <label for="floatingInput">Cantidad</label>
              </div>

              <div class="form-floating col-md-2 justify-content-end">
                <select formControlName="filtroFechas" id="floatingSelect" type="text" class="form-select form-select-sm" aria-label=".form-select-sm example" required>
                  <option value="1">Semana(s)</option>
                  <option value="2">Mes(es)</option>
                  <option value="3">Año(s)</option>
                </select>
                <label for="floatingInput">Filtro</label>
              </div>
            </div>
          </div>
          <div class="mb-3">
            <div class="d-grid gap-2 d-md-flex justify-content-md-center">
              <button class="btn btn-danger btn-danger-sm" type="button" (click)="actualizarCantMinima()">Actualizar</button>
              <button type="button" style="width: 160px;" pButton pRipple icon="pi pi-file-excel" (click)="exportarExcel()" class="p-button-success mr" pTooltip="Exportar a Excel" tooltipPosition="bottom">Exporta a Excel</button>
              <button class="btn btn-danger btn-danger-sm" type="button" (click)="buscarPrecios()">Ult. Actualización</button>
            </div>


          </div>
        </form>-->
     </div>
    </div>
    <!-- Fin fila 1 de campos -->
    <div style="text-align: right;">
      <label><b>Total Stock Zeus ${{totalProductos | number : '1.2-2'}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b></label>
    </div>

    <div class="mb-4">
      <h4 class="tituloRojo">Tabla de Productos</h4>
    </div>
  </div>

  <div class="contain">

    <div class="card" *ngIf="load">
      <p-toolbar styleClass="mb-4 gap-2">
        <ng-template pTemplate="right">
            <button pButton pRipple label="Exportar" icon="pi pi-upload" title="Exportar Excel" class="p-button-success" (click)="exportarExcel()"></button>
        </ng-template>
      </p-toolbar>
      <!--Inicio Tabla-->
      <p-table
        #dt
        [value]="ArrayProductoZeus"
        [resizableColumns]="true"
        columnResizeMode="expand"
        styleClass="p-datatable-gridlines p-datatable-sm"
        responsiveLayout="scroll"
        [paginator]="true"
        [rows]="ArrayProductoZeus.length"
        [showCurrentPageReport]="true"
        [(first)]="first"
        [rowsPerPageOptions]="[10,20,30,50,70,100, ArrayProductoZeus.length]"
        [rowHover]="true"
        [globalFilterFields]="['codigoItem','nombreItem']"
        [reorderableColumns]="true"
        currentPageReportTemplate="Mostrando del {first} al {last} de {totalRecords} registros" >
        <ng-template pTemplate="caption">
          <div class="flex">
            <span class="p-input-icon-left">
              <i class="pi pi-search"></i>
              <input pInputText type="text" placeholder="Buscar Productos..." (input)="aplicarfiltroGlobal($event, 'contains')" />
            </span>
            <!-- <span class="p-input-icon-right buscarActualizacion">
            <label>Buscar última actualización&nbsp;&nbsp;&nbsp;</label>
              <p-inputNumber [(ngModel)]="cantidadDias" placeholder="Cantidad"></p-inputNumber>&nbsp;&nbsp;&nbsp;
              <p-dropdown [(ngModel)]="filtroFechas" [options]="opcionFiltroFechas" (onChange)="buscarPrecios()"></p-dropdown>
            </span> -->
          </div>
        </ng-template>

        <!--Headers Tabla-->
        <ng-template pTemplate="header">
          <tr class="tamanoTitulosTabla">
            <th scope="col" pSortableColumn="codigoItem" pReorderableColumn>Item
              <p-sortIcon field="codigoItem"></p-sortIcon>
              <p-columnFilter type="numeric" field="codigoItem" display="menu"></p-columnFilter>
            </th>
            <th scope="col" pSortableColumn="codigoItem" pReorderableColumn>Cliente
              <p-sortIcon field="codigoItem"></p-sortIcon>
              <p-columnFilter type="text" field="Cliente" display="menu"></p-columnFilter>
            </th>
            <th scope="col" pSortableColumn="nombreItem" pReorderableColumn>Nombre
              <p-sortIcon field="nombreItem"></p-sortIcon>
              <p-columnFilter type="text" field="nombreItem" display="menu"></p-columnFilter>
            </th>
            <th scope="col" pSortableColumn="cantidadItem" pReorderableColumn>Existencias
              <p-sortIcon field="cantidadItem"></p-sortIcon>
              <p-columnFilter type="numeric" field="cantidadItem" display="menu"></p-columnFilter>
            </th>
            <th scope="col" pSortableColumn="PrecioItem" pReorderableColumn>Precio
              <p-sortIcon field="PrecioItem"></p-sortIcon>
              <p-columnFilter type="numeric" field="PrecioItem" display="menu"></p-columnFilter>
            </th>
            <th scope="col" pSortableColumn="presentacion" pReorderableColumn>Presentación
              <p-sortIcon field="presentacion"></p-sortIcon>
              <p-columnFilter type="text" field="presentacion" display="menu"></p-columnFilter>
            </th>
            <th scope="col" pSortableColumn="PrecioTotalItem" pReorderableColumn>Subtotal
              <p-sortIcon field="PrecioTotalItem"></p-sortIcon>
              <p-columnFilter type="numeric" field="PrecioTotalItem" display="menu"></p-columnFilter>
            </th>
            <th scope="col"  pSortableColumn="cantMinima" pReorderableColumn>Cant. Minima
              <p-sortIcon field="cantMinima"></p-sortIcon>
              <p-columnFilter type="numeric" field="cantMinima" display="menu"></p-columnFilter>
            </th>
            <!-- <th scope="col"  pSortableColumn="fechaModificacion">Última actualización
              <p-sortIcon field="fechaModificacion"></p-sortIcon>
            </th> -->
            <th scope="col"  pSortableColumn="fechaModificacion" pReorderableColumn>Vendedor
              <p-sortIcon field="fechaModificacion"></p-sortIcon>
              <p-columnFilter type="text" field="vendedor" display="menu"></p-columnFilter>
            </th>
          </tr>
        </ng-template>
        <!--Cuerpo Tabla-->
        <ng-template pTemplate="body" let-ArrayProductoZeus>
          <tr class="tamanoTextosTabla">
              <td>{{ArrayProductoZeus.codigoItem}}</td>
              <td>{{ArrayProductoZeus.Cliente}}</td>
              <td>{{ArrayProductoZeus.nombreItem}}</td>
              <ng-container *ngIf="ArrayProductoZeus.cantidadItem <= ArrayProductoZeus.cantMinima then rojo else azul;"></ng-container>
              <ng-template #rojo>
                <td style="background-color: rgb(255, 146, 146);">{{ArrayProductoZeus.cantidadItem | number : '1.2-2'}}</td>
              </ng-template>
              <ng-template #azul>
                <td class="TextosInfoTabla2">{{ArrayProductoZeus.cantidadItem | number : '1.2-2'}}</td>
              </ng-template>
              <td>{{ArrayProductoZeus.PrecioItem | currency: 'USD'}}</td>
              <td>{{ArrayProductoZeus.presentacion}}</td>
              <td>{{ArrayProductoZeus.PrecioTotalItem | currency: 'USD'}}</td>
              <td pEditableColumn (click)="seleccionarProducto(ArrayProductoZeus)">
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <input [(ngModel)]="ArrayProductoZeus.cantMinima" class="form-control form-control-sm" type="number" (change)="actualizarCantMinima(ArrayProductoZeus)">
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{ArrayProductoZeus.cantMinima | number}}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td>{{ArrayProductoZeus.vendedor}}</td>
              <!-- <ng-container *ngIf="ArrayProductoZeus.fechaModificacion != ''; then rojo2; else normal"></ng-container> -->
              <!-- <ng-template #rojo2><td style="background-color: rgb(255, 146, 146);">{{ArrayProductoZeus.fechaModificacion}}</td></ng-template> -->
              <!-- <ng-template #normal><td>{{ArrayProductoZeus.fechaModificacion}}</td></ng-template> -->

        </ng-template>
        <ng-template pTemplate="summary">
            <div class="flex align-items-center justify-content-between">
                En total hay {{cantProductos}} productos.
            </div>
        </ng-template>
      </p-table>
    </div>

    <!--<div *ngIf="load">
      <div class="mb-4">
        <div class="row g-3">
          <div class="table-responsive">
            <table class="table table-bordered table-hover mt-2">
              <thead class="TitulosTabla">
                <tr *ngFor="let columnas of titulosTabla let i = index">
                  <th scope="col" class="idProducto">{{columnas.invItem}}</th>
                  <th id="Cliente" scope="col" (dblclick)="organizarCliente_A_Z()" (click)="organizarCliente_Z_A()">{{columnas.invCliente}}</th>
                  <th id="nombre" scope="col" (dblclick)="organizarProducto_A_Z()" (click)="organizarProducto_Z_A()">{{columnas.invNombre}}</th>
                  <th id="precio" scope="col">{{columnas.invPrecio}}</th>
                  <th id="existencias" scope="col"><button class="existencias" (dblclick)="organizarExistenciasDobleClick()" (click)="organizarExistenciasUnClick()"><b>{{columnas.invStock}}</b></button></th>
                  <th id="presentacion" scope="col">{{columnas.presentacion}}</th>
                  <th id="Subtotal" scope="col">{{columnas.invSubtotal}}</th>
                  <th id="cantMinima" scope="col" (click)="organizarCantMinima()">Cant. Minima</th>
                  <th id="cantMinima" scope="col">Actualizar Cant. Minima</th>
                  <ng-container *ngIf="mostrarColumna">
                    <th id="ultimaModificacion" scope="col" >Ult. Modificación</th>
                  </ng-container>

                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let prodZeus of ArrayProductoZeus | filtrosProductosTerminadosZeus: NombrePT | filtroNombreClientePT: NombreCliente let i=index">
                  <th id="id" class="TextosInfoTabla" (click)="seleccionarProducto(prodZeus)">{{prodZeus.codigoItem}}</th>
                  <td id="cliente" class="TextosInfoTabla" (click)="seleccionarProducto(prodZeus)">{{prodZeus.ClienteNombre}}</td>
                  <td id="Nombre" class="TextosInfoTabla" (click)="seleccionarProducto(prodZeus)">{{prodZeus.nombreItem}}</td>
                  <td id="precio" class="TextosInfoTabla" (click)="seleccionarProducto(prodZeus)">{{prodZeus.PrecioItem | number : '1.2-2'}}</td>

                  <td id="existencias" class="TextosInfoTabla2" (click)="seleccionarProducto(prodZeus)">{{prodZeus.cantidadItem | number : '1.2-2'}}</td>

                  <td id="presentacion" scope="TextosInfoTabla" (click)="seleccionarProducto(prodZeus)">{{prodZeus.presentacion}}</td>
                  <td id="subtotal" class="TextosInfoTabla" (click)="seleccionarProducto(prodZeus)">{{prodZeus.PrecioTotalItem | number : '1.2-2'}}</td>
                  <td id="CantMinima" class="TextosInfoTabla" (click)="seleccionarProducto(prodZeus)">{{prodZeus.cantMinima | number : '1.2-2'}}</td>

                  <td (click)="seleccionarProducto(prodZeus)">
                    <form [formGroup]="FormEditarCantMinima">
                      <input type="number" formControlName="cantMinima" class="form-control form-control-sm" style="border: none;" (keyup.enter)="actualizarCantMinima()">
                    </form>
                  </td>

                  <ng-container *ngIf="prodZeus.fechaModificacion != ''">
                    <td id="CantMinima" style="background-color: rgb(255, 146, 146);" class="TextosInfoTabla">{{prodZeus.fechaModificacion}}</td>
                  </ng-container>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>-->
  </div>
</div>
