
<p-card>
  <div *ngIf="!cargando">
    <p-toolbar styleClass="mb-4 gap-2">
      <ng-template pTemplate="left">
        <button pButton pRipple id="nuevo" label="Nuevo" icon="pi pi-plus" class="p-button-success r-2" style="margin-right: 3%;" (click)="modalCrearVistas()"></button>
        <button pButton pRipple id="eliminar" label="Eliminar" icon="pi pi-trash" class="p-button-danger" (click)="eliminarVistas()"></button>
        <ng-template #inactivo>
          <button pButton pRipple id="eliminar-usuario" label="Eliminar"  icon="pi pi-trash" [disabled]="true" class="p-button-danger"></button>
        </ng-template>
      </ng-template>
    </p-toolbar>
    <p-table
    id="tabla"
    #dt
    [value]="arrayVistasPermisos"
    [resizableColumns]="true"
    columnResizeMode="expand"
    styleClass="p-datatable-gridlines p-datatable-sm"
    responsiveLayout="scroll"
    [paginator]="true"
    [rows]="rows"
    [showCurrentPageReport]="true"
    [(first)]="first"
    [rowsPerPageOptions]="[10,20,30,50,70,100]"
    [rowHover]="true"
    [globalFilterFields]="['Id','Nombre','Area']"
    [(selection)]="vistaSeleccionada"
    currentPageReportTemplate="Mostrando del {first} al {last} de {totalRecords} registros" >
    <ng-template pTemplate="caption">
      <div class="flex align-items-center justify-content-between">
        <span class="p-input-icon-left">
          <i class="pi pi-search"></i>
          <input pInputText type="text" id="buscar" placeholder="Buscar Vista..." (input)="aplicarfiltroGlobal($event, 'contains')" pTooltip="Busca usuarios por su Id, Nombre o Área" tooltipPosition="top"/>
        </span>
      </div>
    </ng-template>
    <!--Headers Tabla-->
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 4rem"><p-tableHeaderCheckbox id="check"></p-tableHeaderCheckbox></th>
        <th scope="col" >#</th>
        <th scope="col" pSortableColumn="Nombre">Nombre <p-sortIcon field="Nombre"></p-sortIcon></th>
        <th scope="col" class="text-center">Icono</th>
        <th scope="col" class="text-center">Dock</th>
        <th scope="col">Ruta</th>
        <th scope="col" pSortableColumn="Categoria">Categoria <p-sortIcon field="Categoria"></p-sortIcon></th>
        <th scope="col" pSortableColumn="Roles">Roles <p-sortIcon field="Roles"></p-sortIcon></th>
        <th scope="col">Editar</th>
        <th scope="col">Eliminar</th>
      </tr>
    </ng-template>
    <!--Cuerpo Tabla-->
    <ng-template pTemplate="body" let-vistas let-rowIndex="rowIndex">
      <tr class="font-size-16">
        <td ><p-tableCheckbox [value]="vistas"></p-tableCheckbox></td>
        <td><b>{{rowIndex + 1}}</b></td>
        <td><b>{{vistas.Nombre}}</b></td>
        <td class="text-center"><i class="{{vistas.Icono}}"></i></td>
        <td class="text-center"><img src="../{{vistas.Dock}}" style="width: 20%;"/></td>
        <td>{{vistas.Ruta}}</td>
        <td>{{vistas.Categoria}}</td>
        <td>{{vistas.Roles}}</td>
        <td style="text-align: center;"><button id="editar" (click)="cargarVistas_Id(vistas)" pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-success mr-2" style="width: 30px; height: 30px;"></button></td>
        <td style="text-align: center;"><button id="inactivar" pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-danger" style="width: 30px; height: 30px;"></button></td>
      </tr>
    </ng-template>
    <ng-template pTemplate="summary">
      <div class="flex align-items-center justify-content-between font-size-16">
        En total hay {{totalVistas}} Vistas.
      </div>
    </ng-template>
    </p-table>
  </div>

</p-card>

<p-dialog [(visible)]="modal" [style]="{width: '40vw', }" [resizable]="true" header="{{palabra}} Vista" [modal]="true" styleClass="p-fluid">
  <br>
  <form [formGroup]="formVistas">
    <div class="mb-3">
      <div class="row g-4">

        <!-- Nombre Materia Prima -->
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 col-xxl-6">
          <span class="p-float-label">
            <input formControlName="vNombre" id="vNombre" type="text" pInputText required/>
            <label for="vNombre">Nombre</label>
          </span>
        </div>

         <!-- Menú -->
         <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 col-xxl-6">
          <span class="p-float-label">
            <p-dropdown formControlName="vIcono" inputId="vIcono" optionValue="icon" optionLabel="label" [autoDisplayFirst]="false" [options]="iconos2">
              <ng-template let-vista pTemplate="item">
                <div class="flex align-items-center gap-2">
                  <div><i [class]="vista.icon"></i> {{ vista.label }}</div>
                </div>
              </ng-template>
            </p-dropdown>
            <label for="vIcono">Icono Menú</label>
          </span>
        </div>

        <!-- Icono  -->
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 col-xxl-6">
          <span class="p-float-label">
            <p-dropdown formControlName="vDock" inputId="vDock" optionValue="nombre" optionLabel="descripcion" [options]="imagenes" [autoDisplayFirst]="false">
              <ng-template let-imagen pTemplate="item">
                <div class="flex align-items-center gap-2">
                  <img src="../assets/Iconos_Menu/{{imagen.nombre}}" style="width: 15%;"/>
                  <div>{{imagen.descripcion}}</div>
                </div>
              </ng-template>
            </p-dropdown>
            <label for="vDock">Icono vista fav.</label>
          </span>
        </div>

        <!-- Categoria  -->
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 col-xxl-6">
          <span class="p-float-label">
            <p-multiSelect formControlName="vCategoria" inputId="vCategoria" [options]="arrayVistas"></p-multiSelect>
            <label for="vCategoria">Categoria</label>
          </span>
        </div>

        <!-- Ruta -->
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 col-xxl-6">
          <span class="p-float-label">
            <input formControlName="vRuta" id="vRuta" type="text" pInputText required/>
            <label for="vRuta">Ruta</label>
          </span>
        </div>

        <!-- Categoria  -->
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 col-xxl-6">
          <span class="p-float-label">
            <p-multiSelect formControlName="vRoles" inputId="vRoles" [options]="arrayRoles" optionLabel="rolUsu_Nombre" optionValue="rolUsu_Id"></p-multiSelect>
            <label for="vRoles">Roles</label>
          </span>
        </div>

        <!--Inicio Fila 3 Botones y Limpiar Campos-->
        <div class="mb-3">
          <div class="d-grid gap-2 d-md-flex justify-content-md-center">
            <button pButton class="p-button-danger" type="button" label="{{palabra}} Vista" icon="pi pi-check" (click)="registrarVista()"></button>
            <button pButton class="p-button-secondary" type="button" label="Limpiar Campos" icon="pi pi-eraser" (click)="limpiarCampos()"></button>
          </div>
        </div>

      </div>
    </div>
  </form>
</p-dialog>
