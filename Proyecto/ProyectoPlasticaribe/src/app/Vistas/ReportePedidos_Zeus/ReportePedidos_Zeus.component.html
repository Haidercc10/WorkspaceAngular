<app-menuLateral></app-menuLateral>

<div class="d-flex justify-content-center overlay" *ngIf="cargando">
  <div style="margin: auto;">
    <p-progressSpinner></p-progressSpinner>
  </div>
</div>

<div class="contain">
  <!-- Navegador fin de parte superior -->
  <div class="container-fluid">
    <!-- principal -->
    <div class="mb-4 Titulo">
      <h2 class="tituloRojo">Pedidos de Productos</h2>
    </div>

    <div class="mb-4">
      <hr class="colorLinea">
    </div>
  </div>
</div>

<!-- Tabla de Pedidos -->
<div class="container-fluid">
  <div class="d-grid gap-2 d-md-flex justify-content-md-center" >
    <!--Inicio Tabla OT-->
    <div class="mb-4">
      <div class="row g-3">
        <div class="table-responsive">
          <table class="table table-borderless table-hover mt-2 tableColores font-size-14">
            <thead class="TitulosTabla">
              <td class="verde">
                <a class="btn verde" data-bs-toggle="collapse" href="#multiCollapseExample4" role="button" aria-expanded="false" aria-controls="multiCollapseExample1"><b>Se puede facturar todo el pedido</b></a>
                <div class="row">
                  <div class="col">
                    <div class="collapse multi-collapse" id="multiCollapseExample4">
                      <div class="card card-body">
                        Este color indica que todos los item del pedido puede n fecturados y enviados dado que la cantidad que hay en existencias es igual o superior a la cantidad pendiente del respectivo item.
                      </div>
                    </div>
                  </div>
                </div>
              </td>
              <td class="azul">
                <a class="btn" data-bs-toggle="collapse" href="#multiCollapseExample5" role="button" aria-expanded="false" aria-controls="multiCollapseExample1"><b>Se puede facturar minimo un item del pedido</b></a>
                <div class="row">
                  <div class="col">
                    <div class="collapse multi-collapse" id="multiCollapseExample5">
                      <div class="card card-body">
                        Este color indica que minimo uno de los items del pedido puede ser facturado, ese siempre estará para pedidos con más de un item.
                      </div>
                    </div>
                  </div>
                </div>
              </td>
              <td class="rojo">
                <a class="btn rojo" data-bs-toggle="collapse" href="#multiCollapseExample6" role="button" aria-expanded="false" aria-controls="multiCollapseExample1"><b>Pedidos que no han sido aprobados</b></a>
                <div class="row">
                  <div class="col">
                    <div class="collapse multi-collapse" id="multiCollapseExample6">
                      <div class="card card-body">
                        Este color indica que un pedido no ha sido revisado por una persona autorizada, al ser revisado el pedido será aprobado o anulado.
                      </div>
                    </div>
                  </div>
                </div>
              </td>
            </thead>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="d-grid gap-2 d-md-flex justify-content-md-end">
    <button pButton pRipple label="Exportar Excel" icon="pi pi-file-excel" class="p-button-success r-2" (click)="exportarExcel()"></button>
  </div>
  <div class="mb-4">
    <h3 class="tituloRojo">Información de Pedidos</h3>
  </div>
  <div *ngIf="!cargando" id="tableProcesos" class="font-size-14">
    <div class="mb-4 ">
      <div class="row g-3">
        <p-treeTable #tt
          [value]="ArrayDocumento"
          [columns]="columnasSeleccionada"
          [resizableColumns]="true"
          columnResizeMode="expand"
          styleClass="p-treetable-sm p-treetable-gridlines"
          [paginator]="true"
          [rows]="ArrayDocumento.length"
          [showCurrentPageReport]="true"
          currentPageReportTemplate="Mostrando del {first} al {last} de {totalRecords} registros"
          [rowsPerPageOptions]="[10,20,30,50,70,100, ArrayDocumento.length]"
          [rowHover]="true"
          [scrollable]="true"
          scrollHeight="1000px">
          <!-- Tamaño de columnas -->
          <ng-template pTemplate="colgroup" let-columns>
            <colgroup>
              <col style="width:150px">
              <col style="width:200px">
              <col style="width:200px">
              <col style="width:150px">
              <col style="width:150px">
              <col style="width:150px">
              <col style="width:100px">
              <col style="width:100px">
              <col style="width:200px">
              <col style="width:200px">
              <col style="width:100px">
              <col style="width:300px">
              <col style="width:200px;">
              <col style="width:150px">
              <col *ngFor="let col of columnasSeleccionada" style="width:200px">
              <col style="width:100px">
              <col style="width:100px">
              <col style="width:100px" *ngIf="ValidarRol == 1">
              <col style="width:100px" *ngIf="ValidarRol == 1">
            </colgroup>
          </ng-template>
          <!-- Dropdown para elegir columnas -->
          <ng-template pTemplate="caption">
            <div style="text-align:left">
              <p-multiSelect [options]="columnas" [(ngModel)]="columnasSeleccionada" optionLabel="header" selectedItemsLabel="{0} columnas seleccionadas" [style]="{'width': '20em'}" defaultLabel="Elige las columnas que quieres ver"></p-multiSelect>
            </div>
          </ng-template>
          <!-- Encabezados de columnas -->
          <ng-template pTemplate="header" let-columns>
            <!-- Propiedades de las columnas -->
            <tr>
              <th ttResizableColumn style="width: 150px">
                <input pInputText type="number" style="width: 100%;" (input)="aplicarfiltro($event, 'consecutivo', 'contains')">
              </th>
              <th ttResizableColumn style="width: 200px">
                <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'cliente', 'contains')">
              </th>
              <th ttResizableColumn style="width: 200px">
                <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'producto', 'contains')">
              </th>
              <th ttResizableColumn style="width: 150px">
                <input pInputText type="number" style="width: 100%;" (input)="aplicarfiltro($event, 'cant_Pedida', 'contains')">
              </th>
              <th ttResizableColumn style="width: 150px">
                <input pInputText type="number" style="width: 100%;" (input)="aplicarfiltro($event, 'cant_Pendiente', 'contains')">
              </th>
              <th ttResizableColumn style="width: 150px">
                <input pInputText type="number" style="width: 100%;" (input)="aplicarfiltro($event, 'cant_Facturada', 'contains')">
              </th>
              <th ttResizableColumn style="width: 100px">
                <input pInputText type="number" style="width: 100%;" (input)="aplicarfiltro($event, 'existencias', 'contains')">
              </th>
              <th ttResizableColumn style="width: 100px">
                <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'presentacion', 'contains')">
              </th>
              <th ttResizableColumn style="width: 200px">
                <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'estado', 'contains')">
              </th>
              <th ttResizableColumn style="width: 200px">
                <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'vendedor', 'contains')">
              </th>
              <th ttResizableColumn style="width: 100px">
                <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'OT', 'contains')">
              </th>
              <th ttResizableColumn style="width: 300px">
                <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'Proceso_OT', 'contains')">
              </th>
              <th ttResizableColumn style="width: 200px">
                <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'costo_Cant_Pendiente', 'contains')">
              </th>
              <th ttResizableColumn style="width: 150px">
                <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'costo_Cant_Total', 'contains')">
              </th>
              <th *ngFor="let col of columns" ttResizableColumn style="width: 200px">
                <input pInputText type="{{col.type}}" style="width: 100%;" (input)="aplicarfiltro($event, col.field, 'contains')">
              </th>
              <th ttResizableColumn style="width: 100px">
                <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'consecutivo', 'contains')">
              </th>
              <th ttResizableColumn style="width: 100px">
                <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'consecutivo', 'contains')">
              </th>
              <th ttResizableColumn style="width: 100px" *ngIf="ValidarRol == 1">
                <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'consecutivo', 'contains')">
              </th>
              <th ttResizableColumn style="width: 100px" *ngIf="ValidarRol == 1">
                <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'consecutivo', 'contains')">
              </th>
            </tr>
            <!-- Titulos -->
            <tr>
              <th style="text-align: center; width: max-content;" class="font-size-14" ttSortableColumn="consecutivo">Pedido
                <p-treeTableSortIcon field="consecutivo"></p-treeTableSortIcon>
              </th>
              <th style="text-align: center;" class="font-size-14" ttSortableColumn="cliente">Cliente
                <p-treeTableSortIcon field="cliente"></p-treeTableSortIcon>
              </th>
              <th style="text-align: center;" class="font-size-14" ttSortableColumn="producto">Producto
                <p-treeTableSortIcon field="producto"></p-treeTableSortIcon>
              </th>
              <th style="text-align: center;" class="font-size-14" ttSortableColumn="cant_Pedida">Cant. Pedida
                <p-treeTableSortIcon field="cant_Pedida"></p-treeTableSortIcon>
              </th>
              <th style="text-align: center;" class="font-size-14" ttSortableColumn="cant_Pendiente">Pendiente
                <p-treeTableSortIcon field="cant_Pendiente"></p-treeTableSortIcon>
              </th>
              <th style="text-align: center;" class="font-size-14" ttSortableColumn="cant_Facturada">Facturada
                <p-treeTableSortIcon field="cant_Facturada"></p-treeTableSortIcon>
              </th>
              <th style="text-align: center;" class="font-size-14" ttSortableColumn="existencias">Stock
                <p-treeTableSortIcon field="existencias"></p-treeTableSortIcon>
              </th>
              <th style="text-align: center;" class="font-size-14" ttSortableColumn="presentacion">Und
                <p-treeTableSortIcon field="presentacion"></p-treeTableSortIcon>
              </th>
              <th style="text-align: center;" class="font-size-14" ttSortableColumn="estado">Estado
                <p-treeTableSortIcon field="estado"></p-treeTableSortIcon>
              </th>
              <th style="text-align: center;" class="font-size-14" ttSortableColumn="vendedor">Vendedor
                <p-treeTableSortIcon field="vendedor"></p-treeTableSortIcon>
              </th>
              <th style="text-align: center;" class="font-size-14" ttSortableColumn="OT">OT
                <p-treeTableSortIcon field="OT"></p-treeTableSortIcon>
              </th>
              <th style="text-align: center;" class="font-size-14" ttSortableColumn="Proceso_OT">Proceso Actual
                <p-treeTableSortIcon field="Proceso_OT"></p-treeTableSortIcon>
              </th>
              <th style="text-align: center; width: 100px;" class="font-size-14" ttSortableColumn="costo_Cant_Pendiente">Total Pendiente
                <p-treeTableSortIcon field="costo_Cant_Pendiente"></p-treeTableSortIcon>
              </th>
              <th style="text-align: center;" class="font-size-14" ttSortableColumn="costo_Cant_Total">Total
                <p-treeTableSortIcon field="costo_Cant_Total"></p-treeTableSortIcon>
              </th>
              <th *ngFor="let col of columnasSeleccionada" [ttSortableColumn]="col.field">{{col.header}}
                <p-treeTableSortIcon [field]="col.field"></p-treeTableSortIcon>
              </th>
              <th style="text-align: center;" class="font-size-14">Ver PDF</th>
              <th style="text-align: center;" class="font-size-14">Editar</th>
              <th style="text-align: center;" class="font-size-14" *ngIf="ValidarRol == 1">Aceptar</th>
              <th style="text-align: center;" class="font-size-14" *ngIf="ValidarRol == 1">Anular / Cancelar</th>
            </tr>
          </ng-template>
          <!-- Cuerpo de la tabla con los datos -->
          <ng-template pTemplate="body" let-rowNode let-data="rowData">
            <!-- Validará que sea o no un pedido de Zeus -->
            <ng-container *ngIf="data.Zeus == 1; then EnZeus; else NoZeus"></ng-container>
            <ng-template #EnZeus>
              <ng-container *ngIf="data.ExistenciaMayor; then thenTemplate; else elseTemplate"></ng-container>
              <!-- Existencias mayores o iguales a la cantidad pendiente -->
              <ng-template #thenTemplate>
                <ng-container *ngIf="data.Cant_Items_ExistenciaMayor < data.Cant_Items; then azul; else verde"></ng-container>
                <!-- Cuando un pedido tiene al menos 1 de sus productos con stock suficiente para entregarlo, pero no tiene todos los productos listos para entregar -->
                <ng-template #azul>
                  <tr style="background-color: #aad0f3 ;">
                    <td style="text-align: center;" scope="col" title="N° Pedido" (dblclick)="varOrdenTranajo(data)">
                      <p-treeTableToggler [rowNode]="rowNode" ></p-treeTableToggler>
                      {{data.consecutivo}}
                    </td>
                    <td scope="col" title="Cliente" (dblclick)="varOrdenTranajo(data)">{{data.cliente}}</td>
                    <td scope="col" title="Item" (dblclick)="varOrdenTranajo(data)">{{data.producto}}</td>
                    <td style="text-align: center;" scope="col" title="Cantidad Pedida" (dblclick)="varOrdenTranajo(data)">{{data.cant_Pedida | number : '1.2-2'}}</td>
                    <td style="text-align: center;" scope="col" title="Cantidad Pendiente" class="bg-danger2" (dblclick)="varOrdenTranajo(data)"><b>{{data.cant_Pendiente | number : '1.2-2'}}</b></td>
                    <td style="text-align: center;" scope="col" title="Cantidad Facturada" (dblclick)="varOrdenTranajo(data)">{{data.cant_Facturada | number : '1.2-2'}}</td>
                    <td style="text-align: center;" scope="col" title="Existencias" (dblclick)="varOrdenTranajo(data)">{{data.existencias | number : '1.2-2'}}</td>
                    <td style="text-align: center;" scope="col" title="Presentación" (dblclick)="varOrdenTranajo(data)">{{data.presentacion}}</td>
                    <ng-container *ngIf="data.estado == 'Pendiente'">
                      <td style="text-align: center;" scope="col" title="{{titlePendiente}}." data-bs-toggle="modal" data-bs-target="#modalEstados" (click)="varOrdenTranajo(data)"><span class="badge bg-danger1">{{data.estado}}</span></td>
                    </ng-container>
                    <ng-container *ngIf="data.estado == 'Parcialmente Satisfecho'">
                      <td style="text-align: center;" scope="col" title="{{titleParcial}}" data-bs-toggle="modal" data-bs-target="#modalEstados" (click)="varOrdenTranajo(data)"><span class="badge bg-warning1">{{data.estado}}</span></td>
                    </ng-container>
                    <td scope="col" title="Vendedor">{{data.vendedor}}</td>
                    <td ttEditableColumn>
                      <p-treeTableCellEditor>
                        <ng-template pTemplate="input" *ngIf="ValidarRol == 1">
                          <input class="form-control form-control-sm" style="width: 100px;" type="number" [(ngModel)]="data.OT" (keyup.space)="cambiarOrden_Pedido(data)">
                        </ng-template>
                        <ng-template pTemplate="output">
                          <span class="badge verde" *ngIf="data.Estado_OT == 17">{{data.OT}}</span> <!-- Terminada -->
                          <span class="badge verde2" *ngIf="data.Estado_OT == 18">{{data.OT}}</span> <!-- Cerrada -->
                          <span class="badge rojo" *ngIf="data.Estado_OT == 3">{{data.OT}}</span> <!-- Anulada -->
                          <span class="badge azul" *ngIf="data.Estado_OT == 14">{{data.OT}}</span> <!-- Asignada -->
                          <span class="badge amarillo" *ngIf="data.Estado_OT == 16">{{data.OT}}</span> <!-- En Proceso -->
                          <span class="badge naranja" *ngIf="data.Estado_OT == 15">{{data.OT}}</span> <!-- Abierta -->
                        </ng-template>
                      </p-treeTableCellEditor>
                    </td>
                    <td style="text-align: center;" scope="col" (dblclick)="varOrdenTranajo(data)">
                      <span class="badge verde" *ngIf="data.Estado_OT == 17">{{data.Proceso_OT}}</span> <!-- Terminada -->
                      <span class="badge amarillo" *ngIf="data.Estado_OT == 16">{{data.Proceso_OT}}</span> <!-- En Proceso -->
                    </td>
                    <td style="text-align: center;" scope="col" title="N° Pedido" (dblclick)="varOrdenTranajo(data)">{{data.costo_Cant_Pendiente | number}}</td>
                    <td style="text-align: center;" scope="col" title="N° Pedido" (dblclick)="varOrdenTranajo(data)">{{data.costo_Cant_Total | number}}</td>
                    <td *ngFor="let col of columnasSeleccionada; let i = index"> {{data[col.field]}} </td>
                    <td style="text-align: center;" scope="col" title="Ver detalle del pedido"><button pButton pRipple (click)="mostrarPedidoPdf(data)" icon="pi pi-eye" class="p-button-rounded p-button-success mr-2" style="width: 30px; height: 30px;"></button></td>
                  </tr>
                </ng-template>
                <!-- Cuando tiene todos sus productos con stock suficiente para ser entregados -->
                <ng-template #verde>
                  <tr style="background-color: #ABEBC6 ;">
                    <td style="text-align: center;" scope="col" title="N° Pedido" (dblclick)="varOrdenTranajo(data)">
                      <p-treeTableToggler [rowNode]="rowNode" ></p-treeTableToggler>
                      {{data.consecutivo}}
                    </td>
                    <td scope="col" title="Cliente" (dblclick)="varOrdenTranajo(data)">{{data.cliente}}</td>
                    <td scope="col" title="Item" (dblclick)="varOrdenTranajo(data)">{{data.producto}}</td>
                    <td style="text-align: center;" scope="col" title="Cantidad Pedida" (dblclick)="varOrdenTranajo(data)">{{data.cant_Pedida | number : '1.2-2'}}</td>
                    <td style="text-align: center;" scope="col" title="Cantidad Pendiente" class="bg-danger2" (dblclick)="varOrdenTranajo(data)"><b>{{data.cant_Pendiente | number : '1.2-2'}}</b></td>
                    <td style="text-align: center;" scope="col" title="Cantidad Facturada" (dblclick)="varOrdenTranajo(data)">{{data.cant_Facturada | number : '1.2-2'}}</td>
                    <td style="text-align: center;" scope="col" title="Existencias" (dblclick)="varOrdenTranajo(data)">{{data.existencias | number : '1.2-2'}}</td>
                    <td style="text-align: center;" scope="col" title="Presentación" (dblclick)="varOrdenTranajo(data)">{{data.presentacion}}</td>
                    <ng-container *ngIf="data.estado == 'Pendiente'">
                      <td style="text-align: center;" scope="col" title="{{titlePendiente}}." data-bs-toggle="modal" data-bs-target="#modalEstados" (click)="varOrdenTranajo(data)"><span class="badge bg-danger1">{{data.estado}}</span></td>
                    </ng-container>
                    <ng-container *ngIf="data.estado == 'Parcialmente Satisfecho'">
                      <td style="text-align: center;" scope="col" title="{{titleParcial}}" data-bs-toggle="modal" data-bs-target="#modalEstados" (click)="varOrdenTranajo(data)"><span class="badge bg-warning1">{{data.estado}}</span></td>
                    </ng-container>
                    <td scope="col" title="Vendedor">{{data.vendedor}}</td>
                    <td ttEditableColumn>
                      <p-treeTableCellEditor>
                        <ng-template pTemplate="input" *ngIf="ValidarRol == 1">
                          <input class="form-control form-control-sm" style="width: 100px;" type="number" [(ngModel)]="data.OT" (keyup.space)="cambiarOrden_Pedido(data)">
                        </ng-template>
                        <ng-template pTemplate="output">
                          <span class="badge verde" *ngIf="data.Estado_OT == 17">{{data.OT}}</span> <!-- Terminada -->
                          <span class="badge verde2" *ngIf="data.Estado_OT == 18">{{data.OT}}</span> <!-- Cerrada -->
                          <span class="badge rojo" *ngIf="data.Estado_OT == 3">{{data.OT}}</span> <!-- Anulada -->
                          <span class="badge azul" *ngIf="data.Estado_OT == 14">{{data.OT}}</span> <!-- Asignada -->
                          <span class="badge amarillo" *ngIf="data.Estado_OT == 16">{{data.OT}}</span> <!-- En Proceso -->
                          <span class="badge naranja" *ngIf="data.Estado_OT == 15">{{data.OT}}</span> <!-- Abierta -->
                        </ng-template>
                      </p-treeTableCellEditor>
                    </td>
                    <td style="text-align: center;" scope="col" (dblclick)="varOrdenTranajo(data)">
                      <span class="badge verde" *ngIf="data.Estado_OT == 17">{{data.Proceso_OT}}</span> <!-- Terminada -->
                      <span class="badge amarillo" *ngIf="data.Estado_OT == 16">{{data.Proceso_OT}}</span> <!-- En Proceso -->
                    </td>
                    <td style="text-align: center;" scope="col" title="N° Pedido" (dblclick)="varOrdenTranajo(data)">{{data.costo_Cant_Pendiente | number}}</td>
                    <td style="text-align: center;" scope="col" title="N° Pedido" (dblclick)="varOrdenTranajo(data)">{{data.costo_Cant_Total | number}}</td>
                    <td *ngFor="let col of columnasSeleccionada; let i = index"> {{data[col.field]}} </td>
                    <td style="text-align: center;" scope="col" title="Ver detalle del pedido"><button pButton pRipple (click)="mostrarPedidoPdf(data)" icon="pi pi-eye" class="p-button-rounded p-button-success mr-2" style="width: 30px; height: 30px;"></button></td>
                  </tr>
                </ng-template>
              </ng-template>
              <!-- Existencias menores a la cantidad pendiente -->
              <ng-template #elseTemplate>
                <tr>
                  <td style="text-align: center;" scope="col" title="N° Pedido" (dblclick)="varOrdenTranajo(data)">
                    <p-treeTableToggler [rowNode]="rowNode" ></p-treeTableToggler>
                    {{data.consecutivo}}
                  </td>
                  <td scope="col" title="Cliente" (dblclick)="varOrdenTranajo(data)">{{data.cliente}}</td>
                  <td scope="col" title="Item" (dblclick)="varOrdenTranajo(data)">{{data.producto}}</td>
                  <td style="text-align: center;" scope="col" title="Cantidad Pedida" (dblclick)="varOrdenTranajo(data)">{{data.cant_Pedida | number : '1.2-2'}}</td>
                  <td style="text-align: center;" scope="col" title="Cantidad Pendiente" class="bg-danger2" (dblclick)="varOrdenTranajo(data)"><b>{{data.cant_Pendiente | number : '1.2-2'}}</b></td>
                  <td style="text-align: center;" scope="col" title="Cantidad Facturada" (dblclick)="varOrdenTranajo(data)">{{data.cant_Facturada | number : '1.2-2'}}</td>
                  <td style="text-align: center;" scope="col" title="Existencias" (dblclick)="varOrdenTranajo(data)">{{data.existencias | number : '1.2-2'}}</td>
                  <td style="text-align: center;" scope="col" title="Presentación" (dblclick)="varOrdenTranajo(data)">{{data.presentacion}}</td>
                  <ng-container *ngIf="data.estado == 'Pendiente'">
                    <td style="text-align: center;" scope="col" title="{{titlePendiente}}." data-bs-toggle="modal" data-bs-target="#modalEstados" (click)="varOrdenTranajo(data)"><span class="badge bg-danger1">{{data.estado}}</span></td>
                  </ng-container>
                  <ng-container *ngIf="data.estado == 'Parcialmente Satisfecho'">
                    <td style="text-align: center;" scope="col" title="{{titleParcial}}" data-bs-toggle="modal" data-bs-target="#modalEstados" (click)="varOrdenTranajo(data)"><span class="badge bg-warning1">{{data.estado}}</span></td>
                  </ng-container>
                  <td scope="col" title="Vendedor">{{data.vendedor}}</td>
                  <td ttEditableColumn>
                    <p-treeTableCellEditor>
                      <ng-template pTemplate="input" *ngIf="ValidarRol == 1">
                        <input class="form-control form-control-sm" style="width: 100px;" type="number" [(ngModel)]="data.OT" (keyup.space)="cambiarOrden_Pedido(data)">
                      </ng-template>
                      <ng-template pTemplate="output">
                        <span class="badge verde" *ngIf="data.Estado_OT == 17">{{data.OT}}</span> <!-- Terminada -->
                        <span class="badge verde2" *ngIf="data.Estado_OT == 18">{{data.OT}}</span> <!-- Cerrada -->
                        <span class="badge rojo" *ngIf="data.Estado_OT == 3">{{data.OT}}</span> <!-- Anulada -->
                        <span class="badge azul" *ngIf="data.Estado_OT == 14">{{data.OT}}</span> <!-- Asignada -->
                        <span class="badge amarillo" *ngIf="data.Estado_OT == 16">{{data.OT}}</span> <!-- En Proceso -->
                        <span class="badge naranja" *ngIf="data.Estado_OT == 15">{{data.OT}}</span> <!-- Abierta -->
                      </ng-template>
                    </p-treeTableCellEditor>
                  </td>
                  <td style="text-align: center;" scope="col" (dblclick)="varOrdenTranajo(data)">
                    <span class="badge verde" *ngIf="data.Estado_OT == 17">{{data.Proceso_OT}}</span> <!-- Terminada -->
                    <span class="badge amarillo" *ngIf="data.Estado_OT == 16">{{data.Proceso_OT}}</span> <!-- En Proceso -->
                  </td>
                  <td style="text-align: center;" scope="col" title="N° Pedido" (dblclick)="varOrdenTranajo(data)">{{data.costo_Cant_Pendiente | number}}</td>
                  <td style="text-align: center;" scope="col" title="N° Pedido" (dblclick)="varOrdenTranajo(data)">{{data.costo_Cant_Total | number}}</td>
                  <td *ngFor="let col of columnasSeleccionada; let i = index"> {{data[col.field]}} </td>
                  <td style="text-align: center;" scope="col" title="Ver detalle del pedido"><button pButton pRipple (click)="mostrarPedidoPdf(data)" icon="pi pi-eye" class="p-button-rounded p-button-success mr-2" style="width: 30px; height: 30px;"></button></td>
                </tr>
              </ng-template>
            </ng-template>
            <!-- Se muestra cuando no es un pedido de zeus -->
            <ng-template #NoZeus>
              <tr style="background-color: #FAACAC;">
                <td style="text-align: center;" scope="col" title="N° Pedido" (dblclick)="varOrdenTranajo(data)">
                  <p-treeTableToggler [rowNode]="rowNode" ></p-treeTableToggler>
                  {{data.consecutivo}}
                </td>
                <td scope="col" title="Cliente" (dblclick)="varOrdenTranajo(data)">{{data.cliente}}</td>
                <td scope="col" title="Item" (dblclick)="varOrdenTranajo(data)">{{data.producto}}</td>
                <td style="text-align: center;" scope="col" title="Cantidad Pedida" (dblclick)="varOrdenTranajo(data)">{{data.cant_Pedida | number : '1.2-2'}}</td>
                <td style="text-align: center;" scope="col" title="Cantidad Pendiente" class="bg-danger2" (dblclick)="varOrdenTranajo(data)"><b>{{data.cant_Pendiente | number : '1.2-2'}}</b></td>
                <td style="text-align: center;" scope="col" title="Cantidad Facturada" (dblclick)="varOrdenTranajo(data)">{{data.cant_Facturada | number : '1.2-2'}}</td>
                <td style="text-align: center;" scope="col" title="Existencias" (dblclick)="varOrdenTranajo(data)">{{data.existencias | number : '1.2-2'}}</td>
                <td style="text-align: center;" scope="col" title="Presentación" (dblclick)="varOrdenTranajo(data)">{{data.presentacion}}</td>
                <td style="text-align: center;" scope="col" title="{{titlePendiente}}." data-bs-toggle="modal" data-bs-target="#modalEstados" (click)="varOrdenTranajo(data)"><span class="badge bg-danger1">{{data.estado}}</span></td>
                <td scope="col" title="Vendedor">{{data.vendedor}}</td>
                <td></td>
                <td style="text-align: center;" scope="col"></td>
                <td style="text-align: center;" scope="col" title="N° Pedido" (dblclick)="varOrdenTranajo(data)">{{data.costo_Cant_Pendiente | number}}</td>
                <td style="text-align: center;" scope="col" title="N° Pedido" (dblclick)="varOrdenTranajo(data)">{{data.costo_Cant_Total | number}}</td>
                <td *ngFor="let col of columnasSeleccionada; let i = index"> {{data[col.field]}} </td>
                <td style="text-align: center;" scope="col" title="Ver detalle del pedido"><button pButton pRipple (click)="productosPedido(data.consecutivo)" icon="pi pi-eye" class="p-button-rounded p-button-success mr-2" style="width: 30px; height: 30px;"></button></td>
                <td style="text-align: center;" scope="col" title="Editar Pedido"><button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-info mr-2" data-bs-toggle="modal" data-bs-target="#staticBackdrop2" (click)="editarPedido(data)" style="width: 30px; height: 30px;"></button></td>
                <td style="text-align: center;" scope="col" title="Confirmar Pedido" *ngIf="ValidarRol == 1"><button (click)="confirmarActualizacion(data.consecutivo)" pButton pRipple icon="pi pi-check" class="p-button-rounded p-button-success mr-2" style="width: 30px; height: 30px;"></button></td>
                <td style="text-align: center;" scope="col" title="Confirmar Pedido" *ngIf="ValidarRol == 1"><button (click)="confirmarCancelacion(data.consecutivo)" pButton pRipple icon="pi pi-times" class="p-button-rounded p-button-danger mr-2" style="width: 30px; height: 30px;"></button></td>
              </tr>
            </ng-template>
          </ng-template>
          <!-- Footer de la Tabla -->
          <ng-template pTemplate="footer">
            <tr>
              <td colspan="12" class="text-right">Totales</td>
              <td>{{sumaCostoPendiente | number : '1.2-2'}}</td>
              <td>{{sumaCostoTotal | number : '1.2-2'}}</td>
              <td>COP</td>
            </tr>
          </ng-template>
          <!-- Cantidad de datos en la tabla -->
          <ng-template pTemplate="summary">
            <div class="p-d-flex p-ai-center p-jc-between">
              En total hay {{ArrayDocumento ? ArrayDocumento.length : 0 | number : '1.2-2'}} Pedido(s).
            </div>
          </ng-template>
        </p-treeTable>
      </div>
    </div>
  </div>
</div>

<!-- Model que mostrará la información de las ordenes de trabajo con un estado especifico -->
<p-dialog [(visible)]="modalEstadosOrdenes" [style]="{width: '1800px'}" [breakpoints]="{'960px': '75vw', '640px': '100vw'}" header="Estados de la orden de trabajo del pedido {{consecutivoPedido}}" [modal]="true" styleClass="p-fluid">
  <ng-template pTemplate="content">
    <app-Reporte_Procesos_OT></app-Reporte_Procesos_OT>
  </ng-template>
</p-dialog>

<!-- Modal desde el que se podrá editar un pedido -->
<div class="modal fade" id="staticBackdrop2" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel2">Editar Pedido</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" (click)="ngOnInit()"></button>
      </div>
      <div class="modal-body">
        <app-Pedido-Externo></app-Pedido-Externo>
      </div>
    </div>
  </div>
</div>
