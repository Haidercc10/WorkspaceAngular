<app-menuLateral></app-menuLateral>

<div class="d-flex justify-content-center overlay" *ngIf="cargando">
  <div class="spinner-border text-danger" role="status" style="margin: auto;">
    <span class="visually-hidden">Cargando...</span>
  </div>
</div>

<div class="contain">
  <!-- Navegador fin de parte superior -->
  <div class="container-fluid">
    <!-- principal -->
    <div class="mb-4 Titulo">
      <h2 class="tituloRojo">Pedidos de Productos</h2>
    </div>

    <div class="mb-4">
      <hr class="colorLinea">
    </div>
  </div>
</div>

<div class="contain"></div>

  <div class="container-xxl">
    <!--<div class="mb-4">
      <h4 class="tituloRojo">Filtros de búsqueda</h4>
    </div>-->

    <!--
    <form [formGroup]="formFiltros">
      <div class="mb-3">
        <div class="row g-3">


          <div class="form-floating col-md">
            <input formControlName="Vendedor" class="form-control form-control-sm" (keyup)="cargarVendedores()" list="vendedor" id="floatingInput" title="Nombre de la Materia Prima" required>
            <datalist id="vendedor">
              <option *ngFor="let item of arrayVendedores">{{item.nombvende}}</option>
            </datalist>
            <label for="floatingInput">Vendedor</label>
          </div>


        <div class="form-floating col-md-3">
          <input formControlName="Cliente" class="form-control form-control-sm" list="clientes" id="floatingInput" (keyup)="cargarClientes()" title="Nombre de la Materia Prima" required>
          <datalist id="clientes">
            <option *ngFor="let item of arrayClientes">{{item.razoncial}}</option>
          </datalist>
          <label for="floatingInput">Cliente</label>
        </div>


          <div class="form-floating col-md-3">
            <input formControlName="Item" class="form-control form-control-sm" list="item" id="floatingInput" (keyup)="cargarItems()" title="Nombre de la Materia Prima" required>
            <datalist id="item">
              <option *ngFor="let item of arrayItems">{{item.nombre}}</option>
            </datalist>
            <label for="floatingInput">Item</label>
          </div>


          <div class="form-floating col-md">
            <input formControlName="Fecha1" type="date" min="0" class="form-control" id="floatingInput"required >
            <label for="floatingInput">Fecha Inicial</label>
          </div>


          <div class="form-floating col-md">
            <input formControlName="Fecha2" type="date" min="0"  class="form-control" id="floatingInput"required >
            <label for="floatingInput">Fecha Final</label>
           </div>
        </div>
      </div>
      <div class="mb-3">
        <div class="d-grid gap-2 d-md-flex justify-content-md-center">
          <button class="btn btn-danger btn-danger-sm" type="button" ><i class="pi pi-search"></i> Consultar</button>
          <button class="btn btn-secondary btn-secondary-sm" type="button" ><i class="pi pi-eraser"></i> Limpiar Campos</button>
        </div>
      </div>
    </form>-->
  </div>
  <!-- Tabla de Pedidos -->
  <div class="container-fluid tablaDatos">
    <div class="mb-4">
      <h3 class="tituloRojo">Información de Pedidos</h3>
    </div>
      <div *ngIf="!cargando" id="tableProcesos" style="font-size: 14px;">
        <div class="mb-4 ">
          <div class="row g-3">
            <p-table
              #dt
              [columns]="columnasSeleccionada"
              [value]="ArrayDocumento"
              [resizableColumns]="true"
              columnResizeMode="expand"
              styleClass="p-datatable-gridlines p-datatable-sm"
              responsiveLayout="scroll"
              [paginator]="true"
              [rows]="20"
              [showCurrentPageReport]="true"
              [(first)]="first"
              currentPageReportTemplate="Mostrando del {first} al {last} de {totalRecords} registros"
              [rowsPerPageOptions]="[10,20,30,50,70,100, ArrayDocumento.length]"
              [rowHover]="true"
              dataKey="id">
              <!-- Columnas Seleccionables -->
              <ng-template pTemplate="caption">
                <p-multiSelect
                  [options]="columnas"
                  [(ngModel)]="columnasSeleccionada"
                  optionLabel="header"
                  selectedItemsLabel="{0} columnas seleccionadas"
                  [style]="{minWidth: '300px'}"
                  placeholder="Elige las columnas que quieres ver"></p-multiSelect>
              </ng-template>
              <!-- Columnas Principales -->
              <ng-template pTemplate="header" let-columns>
                <tr>
                  <th style="text-align: center; font-size: 14px;" scope="col" pSortableColumn="consecutivo">Pedido
                    <p-sortIcon field="consecutivo"></p-sortIcon>
                  </th>
                  <th style="text-align: center; font-size: 14px;" scope="col" pSortableColumn="cliente">Cliente
                    <p-sortIcon field="cliente"></p-sortIcon>
                  </th>
                  <th style="text-align: center; font-size: 14px;" scope="col" pSortableColumn="producto">Producto
                    <p-sortIcon field="producto"></p-sortIcon>
                  </th>
                  <th style="text-align: center; font-size: 14px;" scope="col" pSortableColumn="cant_Pedida">Cant. Pedida
                    <p-sortIcon field="cant_Pedida"></p-sortIcon>
                  </th>
                  <th style="text-align: center; font-size: 14px;" scope="col" pSortableColumn="cant_Pendiente">Cant. Pendiente
                    <p-sortIcon field="cant_Pendiente"></p-sortIcon>
                  </th>
                  <th style="text-align: center; font-size: 14px;" scope="col" pSortableColumn="cant_Facturada">Cant. Facturada
                    <p-sortIcon field="cant_Facturada"></p-sortIcon>
                  </th>
                  <th style="text-align: center; font-size: 14px;" scope="col" pSortableColumn="existencias">Stock
                    <p-sortIcon field="existencias"></p-sortIcon>
                  </th>
                  <th style="text-align: center; font-size: 14px;" scope="col" pSortableColumn="presentacion">Und
                    <p-sortIcon field="presentacion"></p-sortIcon>
                  </th>
                  <th style="text-align: center; font-size: 14px;" scope="col" pSortableColumn="Estado">Estado
                    <p-sortIcon field="Estado"></p-sortIcon>
                  </th>
                  <th style="text-align: center; font-size: 14px;" scope="col" pSortableColumn="vendedor">Vendedor
                    <p-sortIcon field="vendedor"></p-sortIcon>
                  </th>
                  <th *ngFor="let col of columns" pResizableColumn style="font-size: 14px;">
                    {{col.header}}
                  </th>
                </tr>

                <!-- Campo de Busqueda -->
                <tr title="Filtros para realizar busquedas de cada campo">
                  <th>
                      <input pInputText type="number" style="width: 100%;" (input)="aplicarfiltro($event, 'consecutivo', 'contains')" class="w-full"> <!--(input)="dt1.filter($event.target.value, 'name', 'contains')" -->
                  </th>
                  <th>
                      <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'cliente', 'contains')" class="w-full">
                  </th>
                  <th>
                      <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'producto', 'contains')" class="w-full">
                  </th>
                  <th>
                      <input pInputText type="number" style="width: 100%;" (input)="aplicarfiltro($event, 'cant_Pedida', 'contains')" class="w-full">
                  </th>
                   <th>
                      <input pInputText type="number" style="width: 100%;" (input)="aplicarfiltro($event, 'cant_Pendiente', 'contains')" class="w-full">
                  </th>
                  <th>
                      <input pInputText type="number" style="width: 100%;" (input)="aplicarfiltro($event, 'cant_Facturada', 'contains')" class="w-full">
                  </th>
                   <th>
                      <input pInputText type="number" style="width: 100%;" (input)="aplicarfiltro($event, 'existencias', 'contains')" class="w-full">
                  </th>
                  <th>
                      <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'presentacion', 'contains')" class="w-full">
                  </th>
                  <th>
                    <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'estado', 'contains')" class="w-full">
                  </th>
                  <th>
                      <input pInputText type="text" style="width: 100%;" (input)="aplicarfiltro($event, 'vendedor', 'contains')" class="w-full">
                  </th>
                  <th *ngFor="let col of columns">
                    <input pInputText type="{{col.type}}" style="width: 100%;" (input)="aplicarfiltro($event, col.field, 'contains')" class="w-full">
                  </th>
              </tr>
              </ng-template>

              <!-- Cuerpo de la tabla -->
              <ng-template pTemplate="body" let-data let-columns="columns">
                <tr style="cursor: pointer;" title="Con la tecla shift y el scroll del mouse puede moverse hacia los lados de la tabla">
                  <td style="text-align: center;" scope="col" title="N° Pedido">{{data.consecutivo}}</td>
                  <td scope="col" title="Cliente">{{data.cliente}}</td>
                  <td scope="col" title="Item">{{data.producto}}</td>
                  <td style="text-align: center;" scope="col" title="Cantidad Pedida">{{data.cant_Pedida | number : '1.2-2'}}</td>
                  <td style="text-align: center;" scope="col" title="Cantidad Pendiente" class="bg-danger2"><b>{{data.cant_Pendiente | number : '1.2-2'}}</b></td>
                  <td style="text-align: center;" scope="col" title="Cantidad Facturada">{{data.cant_Facturada | number : '1.2-2'}}</td>
                  <td style="text-align: center;" scope="col" title="Existencias">{{data.existencias | number : '1.2-2'}}</td>
                  <td style="text-align: center;" scope="col" title="Presentación">{{data.presentacion}}</td>
                  <ng-container *ngIf="data.estado == 'Pendiente'">
                      <td style="text-align: center;" scope="col" title="{{titlePendiente}}."><span class="badge bg-danger1">{{data.estado}}</span></td>
                  </ng-container>
                  <ng-container *ngIf="data.estado == 'Parcialmente Satisfecho'">
                      <td style="text-align: center;" scope="col" title="{{titleParcial}}"><span class="badge bg-warning1">{{data.estado}}</span></td>
                  </ng-container>
                  <td scope="col" title="Vendedor">{{data.vendedor}}</td>
                  <td *ngFor="let col of columns">{{data[col.field]}}</td>
                </tr>
              </ng-template>

              <!-- Footer de la Tabla -->
              <ng-template pTemplate="footer" *ngIf="ValidarRol == 1">
                <tr>
                  <td colspan="15" class="text-right">
                  </td>
                </tr>
              </ng-template>

              <ng-template pTemplate="summary">
                <div class="p-d-flex p-ai-center p-jc-between">
                  En total hay {{ArrayDocumento ? ArrayDocumento.length : 0 | number : '1.2-2'}} Pedido(s).
                </div>
              </ng-template>
            </p-table>

          </div>
        </div>
      </div>
  </div>
