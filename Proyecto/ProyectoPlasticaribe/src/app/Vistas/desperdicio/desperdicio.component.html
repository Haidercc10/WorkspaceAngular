<!--Navegador parte superior -->
<app-menuLateral></app-menuLateral>

<div class="d-flex justify-content-center overlay" *ngIf="cargando">
  <div style="margin: auto;">
    <p-progressSpinner></p-progressSpinner>
  </div>
</div>

<div class="contain">
  <div class="container-fluid">
    <div class="mb-4 Titulo">
      <h2 class="tituloRojo">Desperdicio</h2>
    </div>
    <div class="mb-4">
      <hr class="colorLinea">
    </div>
  </div>
</div>

<div class="formulario">
  <div class="mb-4">
    <h4 class="tituloRojo"><i class="pi pi-cloud-download"></i>  Registro de Desperdicio</h4>
  </div>
  <br>

  <!-- Formulario del pedido de mantenimiento -->
  <form [formGroup]="FormDesperdicio">
    <div class="mb-3">
      <div class="row g-4">
        <!-- OT -->
        <div class="col-md-2">
          <span class="p-input-icon-left p-float-label">
            <i class="pi pi-search"></i>
            <input formControlName="OTDesperdicio" id="ordenTrabajo" class="form-control form-control-sm" type="text" pInputText (keyup.enter)="consultarOrdenTrabajo()"/>
            <label for="ordenTrabajo">OT</label>
          </span>
        </div>

        <!-- ID PRODUCTO -->
        <div class="col-md">
          <span class="p-float-label">
            <p-inputNumber formControlName="IdProducto" id="IdProducto" [readonly]="true"></p-inputNumber>
            <label for="IdProducto">Id Producto</label>
          </span>
        </div>

        <!-- NOMBRE PRODUCTO -->
        <div class="col-md-4">
          <span class="p-float-label">
            <input formControlName="Producto" id="Producto" class="form-control form-control-sm" type="text" pInputText readonly/>
            <label for="Producto">Producto</label>
          </span>
        </div>

        <!-- TIPO DE MATERIAL -->
        <div class="col-md-3">
          <span class="p-float-label">
            <input formControlName="TipoMaterial" id="Nombre" list="material" class="form-control form-control-sm" type="text" pInputText/>
            <datalist id="material">
              <option value={{item.material_Id}} *ngFor="let item of materiales">{{item.material_Nombre}}</option>
            </datalist>
            <label for="material">Material</label>
          </span>
        </div>

        <!-- IMPRESO -->
        <div class="form-floating col-md-2">
          <div class="field-radiobutton">
            <p-radioButton formControlName="Impreso" name="Impreso" value="SI" inputId="city1"></p-radioButton>
            <label for="city1">Impreso</label>
          </div>
          <div class="field-radiobutton">
            <p-radioButton formControlName="Impreso" name="Impreso" value="NO" inputId="city2"></p-radioButton>
            <label for="city2">No Impreso</label>
          </div>
        </div>

        <!-- MAQUINA -->
        <div class="col-md-2">
          <span class="p-float-label">
            <input formControlName="Maquina" id="Maquina" list="Maquinas" class="form-control form-control-sm" type="text" pInputText (change)="buscarMaquina()" />
            <datalist id="Maquinas">
              <option value={{item.actv_Id}} *ngFor="let item of maquinas">{{item.actv_Nombre}}</option>
            </datalist>
            <label for="Maquina">Maquinas</label>
          </span>
        </div>

        <!-- OPERARIO -->
        <div class="col-md-3">
          <span class="p-float-label">
            <input formControlName="Operario" id="Operario" list="Operarios" class="form-control form-control-sm" type="text" pInputText (change)="buscarOperario()"/>
            <datalist id="Operarios">
              <option value={{item.usua_Id}} *ngFor="let item of operarios">{{item.usua_Nombre}}</option>
            </datalist>
            <label for="Operario">Operarios</label>
          </span>
        </div>

        <!-- NO CONFORMIDAD -->
        <div class="col-md-3">
          <span class="p-float-label">
            <input formControlName="TipoNoConformidad" id="NoConformidad" list="TipoNoConformidad" class="form-control form-control-sm" type="text" pInputText (change)="buscarFalla()"/>
            <datalist id="TipoNoConformidad">
              <option value={{item.falla_Id}} *ngFor="let item of fallas">{{item.falla_Nombre}}</option>
            </datalist>
            <label for="NoConformidad">No Conformidad</label>
          </span>
        </div>

        <!-- CANTIDAD DE DESPERDICIO -->
        <div class="col-md">
          <span class="p-float-label">
            <p-inputNumber formControlName="CantidadKg" id="Cantidad" mode="decimal" [minFractionDigits]="2"></p-inputNumber>
            <label for="Cantidad">Cantidad</label>
          </span>
        </div>

        <!-- AREA -->
        <div class="col-md-2">
          <span class="p-float-label">
            <input formControlName="Area" id="Areas" list="Area" class="form-control form-control-sm" type="text" pInputText (change)="buscarProceso()"/>
            <datalist id="Area">
              <option value={{item.proceso_Id}} *ngFor="let item of procesos">{{item.proceso_Nombre}}</option>
            </datalist>
            <label for="Areas">Area</label>
          </span>
        </div>

        <!-- FECHA ENTREGA -->
        <div class="col-md-2">
          <span class="p-float-label">
            <p-calendar formControlName="Fecha" inputId="FechaInicial" [showIcon]="true"></p-calendar>
            <label for="FechaInicial">Fecha Entrega</label>
          </span>
        </div>

        <!-- OBSERVACION -->
        <div class="col-md">
          <span class="p-float-label">
            <textarea formControlName="Observacion" [rows]="1" class="form-control form-control-sm" maxlength="200" pInputTextarea></textarea>
            <label for="textarea">Observación</label>
          </span>
        </div>
      </div>
    </div>

    <!-- BOTONES -->
    <div class="mb-4">
      <div class="d-grid gap-2 d-md-flex justify-content-md-center">
        <button pButton class="p-button-danger" type="button" label="Añadir Desperdicio" icon="pi pi-send" (click)="llenarTabla()"></button>
        <button pButton class="p-button-secondary" type="button" label="Limpiar Campos" icon="pi pi-eraser" (click)="limpiarCampos()"> </button>
      </div>
    </div>
  </form>

  <!-- TABLA DE RETIRO -->
  <div class="row g-3">
    <div class="table-responsive">
      <p-table
        #dt
        [resizableColumns]="true"
        columnResizeMode="expand"
        styleClass="p-datatable-gridlines p-datatable-sm"
        responsiveLayout="scroll"
        [paginator]="true"
        [rows]="20"
        [rowHover]="true"
        [value]="grupoDespercios">
        <ng-template pTemplate="header">
          <tr>
            <th scope="col">OT</th>
            <th scope="col">Item</th>
            <th scope="col">Maquina</th>
            <th scope="col">Material</th>
            <th scope="col">Operario</th>
            <th scope="col">Area</th>
            <th scope="col">No Conformidad</th>
            <th scope="col">Cantidad Kg</th>
            <th scope="col">Impreso</th>
            <th scope="col">Observacion</th>
            <th scope="col"></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-desperdicio>
          <tr>
            <td>{{desperdicio.Ot}}</td>
            <td>{{desperdicio.Item}}</td>
            <td>{{desperdicio.Maquina}}</td>
            <td>{{desperdicio.Material}}</td>
            <td>{{desperdicio.Operario}}</td>
            <td>{{desperdicio.Area}}</td>
            <td>{{desperdicio.NoConformidad}}</td>
            <td>{{desperdicio.Cantidad}}</td>
            <td>{{desperdicio.Impreso}}</td>
            <td>{{desperdicio.Observacion}}</td>
            <td><i class="pi pi-trash cursor" title="Quitar Desperdicio" (click)="quitarDesperdicio(desperdicio)"></i></td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <br>
  <div class="d-grid gap-2 d-md-flex justify-content-md-center">
    <button pButton class="p-button-danger" type="button" label="Crear Desperdicio" icon="pi pi-check" (click)="crearDesperdicio()"></button>
    <button pButton class="p-button-secondary" type="button" label="Limpiar Todo" icon="pi pi-eraser" (click)="limpiarTodo()"> </button>
  </div>
</div>
