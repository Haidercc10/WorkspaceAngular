<p-toast position="center" [preventOpenDuplicates]="true"></p-toast>

<app-menuLateral></app-menuLateral>
<br>

<div class="d-flex justify-content-center overlay" *ngIf="!load">
  <div style="margin: auto;">
    <p-progressSpinner></p-progressSpinner>
  </div>
</div>

<div class="contain">
  <!-- Navegador fin de parte superior -->
  <div class="container-fluid">
    <!-- principal -->
    <div class="mb-4 Titulo">
      <h2 class="tituloRojo font-size-32">Rollos eliminados</h2>
    </div>

    <div class="mb-4">
      <hr class="colorLinea">
    </div>
  </div>
</div>

<div class="formulario">
  <div class="mb-4">
    <h4 class="tituloRojo font-size-24"><i class="pi pi-filter"></i> Filtros de b√∫squeda</h4>
  </div>
  <br>

  <form [formGroup]="formConsultaRollos">
    <div class="mb-3">
      <div class="row g-3">

        <!-- OT -->
        <div class="col-md">
          <span class="p-float-label">
            <input formControlName="OT" id="ordenTrabajo" class="form-control form-control-sm" type="text" pInputText required/>
            <label for="ordenTrabajo">OT</label>
          </span>
        </div>

        <!-- Rollo -->
        <div class="col-md">
          <span class="p-float-label">
            <input formControlName="rollo" id="Rollo" class="form-control form-control-sm" type="text" pInputText required/>
            <label for="Rollo">Rollo</label>
          </span>
        </div>

        <!-- Fecha Inicial -->
        <div class="col-md">
          <span class="p-float-label">
            <p-calendar formControlName="fecha" inputId="FechaInicial" [showIcon]="true"></p-calendar>
            <label for="FechaInicial">Fecha Inicial</label>
          </span>
        </div>

        <!-- Fecha Final -->
        <div class="col-md">
          <span class="p-float-label">
            <p-calendar formControlName="fechaFinal" inputId="FechaFinal" [showIcon]="true"></p-calendar>
            <label for="FechaFinal">Fecha Final</label>
          </span>
        </div>

        <!-- Procesos -->
        <div class="col-md-2">
          <span class="p-float-label">
            <p-dropdown formControlName="Proceso" inputId="Proceso" [autoDisplayFirst]="false" [options]="arrayProcesos" optionValue="proceso_Id" optionLabel="proceso_Nombre"></p-dropdown>
            <label for="Proceso">Proceso</label>
          </span>
        </div>

        <!-- Item -->
        <div class="col-md-2">
          <span class="p-float-label">
            <input formControlName="producto" id="Item" class="form-control form-control-sm" list="items" type="text" pInputText (change)='selectEventProducto()' [(ngModel)]="Item" (keyup)="obtenerProductos()"/>
            <datalist id="items">
              <option value={{item.prod_Id}} *ngFor="let item of arrayProductos">{{item.prod_Nombre}}</option>
            </datalist>
            <label for="Item">Item</label>
          </span>
        </div>
      </div>
    </div>

    <!-- BOTONES -->
    <div class="mb-1">
      <div class="d-grid gap-2 d-md-flex justify-content-md-center">
        <button pButton class="p-button-danger" type="button" label="Consultar" icon="pi pi-search" (click)="validarConsulta()"> </button>
        <button pButton class="p-button-secondary" type="button" label="Limpiar Campos" icon="pi pi-eraser" (click)="LimpiarCampos()"> </button>
        <button pButton class="p-button-danger" type="button" label="Exportar" pTooltip="Generar archivo Excel/PDF" icon="pi pi-file-export" (click)="validarConsulta()"> </button>
      </div>
    </div>
  </form>

  <div id="tableProcesos" *ngIf="load">
    <div class="mb-4">
      <div class="row g-3">

        <p-table
          #dt
          [columns]="columnasSeleccionada"
          [value]="ArrayDocumento"
          [resizableColumns]="true"
          columnResizeMode="expand"
          styleClass="p-datatable-gridlines p-datatable-sm"
          responsiveLayout="scroll"
          [paginator]="true"
          [rows]="rows"
          [showCurrentPageReport]="true"
          [(first)]="first"
          responsiveLayout="scroll"
          currentPageReportTemplate="Mostrando del {first} al {last} de {totalRecords} registros"
          [rowsPerPageOptions]="[10,20,30,50,70,100]"
          [rowHover]="true"
          dataKey="id">
          <!-- Buscador de columnas -->
          <ng-template pTemplate="caption">
            <p-multiSelect
              [options]="columnas"
              [(ngModel)]="columnasSeleccionada"
              optionLabel="header"
              selectedItemsLabel="{0} columnas seleccionadas"
              [style]="{minWidth: '330px'}"
              class="font-size-16"
              placeholder="Elige las columnas que quieres ver"></p-multiSelect>
          </ng-template>
          <!-- Titulos -->
          <ng-template pTemplate="header" let-columns>
            <tr class="font-size-13">
              <th id="" scope="col" pSortableColumn="ot">OT
                <p-columnFilter type="text" field="ot" display="menu"></p-columnFilter></th>
              <th id="" scope="col" pResizableColumn >Rollo</th>
              <th id="" scope="col" pResizableColumn >Cliente</th>
              <th id="" scope="col" pResizableColumn >Item</th>
              <th id="" scope="col" pResizableColumn >Nombre Item</th>
              <th id="" scope="col" pResizableColumn >Ancho</th>
              <th id="" scope="col" pResizableColumn >Largo</th>
              <th id="" scope="col" pResizableColumn >Fuelle</th>
              <th id="" scope="col" pResizableColumn >Medida</th>
              <th id="" scope="col" pResizableColumn >Peso</th>
              <th id="" scope="col" pResizableColumn >Und.</th>
              <th id="" scope="col" pResizableColumn >Fecha</th>
              <th id="" scope="col" pResizableColumn >Proceso</th>
              <th *ngFor="let col of columns" pResizableColumn>
                {{col.header}}
              </th>
          </tr>
          </ng-template>
          <ng-template pTemplate="body" let-rowData let-ArrayDocumento let-columns="columns">
            <tr class="font-size-13">
              <td id="OT" scope="col">{{ArrayDocumento.Orden}}</td>
              <td id="Rollo" scope="col">{{ArrayDocumento.Rollo}}</td>
              <td id="Cliente" scope="col">{{ArrayDocumento.Cliente}}</td>
              <td id="ItemId" scope="col">{{ArrayDocumento.Item_Id}}</td>
              <td id="Item" scope="col">{{ArrayDocumento.Item}}</td>
              <td id="Ancho" scope="col">{{ArrayDocumento.Ancho | number: '1.2-2'}}</td>
              <td id="Largo" scope="col">{{ArrayDocumento.Largo | number: '1.2-2'}}</td>
              <td id="Fuelle" scope="col">{{ArrayDocumento.Fuelle | number: '1.2-2'}}</td>
              <td id="Medida" scope="col">{{ArrayDocumento.Medida}}</td>
              <td id="Neto" scope="col">{{ArrayDocumento.Peso}}</td>
              <td id="Und" scope="col">{{ArrayDocumento.Kg }}</td>
              <td id="Fecha" scope="col">{{ArrayDocumento.Fecha}}</td>
              <td id="Fecha" scope="col">{{ArrayDocumento.Proceso}}</td>
              <td *ngFor="let col of columns">{{ArrayDocumento[col.field]}}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</div>
